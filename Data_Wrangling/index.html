



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A R documentation website.">
      
      
        <link rel="canonical" href="https://ugoproto.github.io/ugo_r_doc/Data_Wrangling/">
      
      
        <meta name="author" content="Ugo Sparks">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.3">
    
    
      
        <title>Data Wrangling - ugo_r_doc</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#data-analysis-in-r-the-datatable-way" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://ugoproto.github.io/ugo_r_doc/" title="ugo_r_doc" class="md-header-nav__button md-logo">
          
            <i class="md-icon">layers</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                ugo_r_doc
              </span>
              <span class="md-header-nav__topic">
                Data Wrangling
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ugoproto/ugo_r_doc.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ugo_r_doc
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://ugoproto.github.io/ugo_r_doc/" title="ugo_r_doc" class="md-nav__button md-logo">
      
        <i class="md-icon">layers</i>
      
    </a>
    ugo_r_doc
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ugoproto/ugo_r_doc.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ugo_r_doc
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Basics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../R_CS/" title="R Cheat Sheets" class="md-nav__link">
      R Cheat Sheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../An Introduction to R/" title="An Introduction to R" class="md-nav__link">
      An Introduction to R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Le logiciel R, maitriser le langage, effectuer des analyses (bio)statistiques/" title="Le logiciel R, maitriser le langage, effectuer des analyses (bio)statistiques" class="md-nav__link">
      Le logiciel R, maitriser le langage, effectuer des analyses (bio)statistiques
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Formulas_in_R/" title="Formulas in R" class="md-nav__link">
      Formulas in R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Improved_codes/" title="Improved Codes" class="md-nav__link">
      Improved Codes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Intermediate_R/" title="Intermediate R" class="md-nav__link">
      Intermediate R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Intermediate_R_-_The_apply_Family/" title="Intermediate R - The apply Family" class="md-nav__link">
      Intermediate R - The apply Family
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      RStudio
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        RStudio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Code___Plot_Chunk_Options/" title="Code & Plot Chunk Options" class="md-nav__link">
      Code & Plot Chunk Options
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Working_with_RStudio_IDE/" title="Working with the RStudio IDE" class="md-nav__link">
      Working with the RStudio IDE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Data Wrangling Snippets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Data Wrangling Snippets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../IO_snippets___Cleaning/" title="I/O Snippets & Cleaning" class="md-nav__link">
      I/O Snippets & Cleaning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Reading_Data_into_R_with_readr/" title="Reading Data into R with readr" class="md-nav__link">
      Reading Data into R with readr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Data_Analysis_in_R,_the_data.table_Way/" title="Data Analysis in R, the data.table Way" class="md-nav__link">
      Data Analysis in R, the data.table Way
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Data_Manipulation_in_R_with_dplyr/" title="Data Manipulation in R with dplyr" class="md-nav__link">
      Data Manipulation in R with dplyr
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Data Wrangling
      </label>
    
    <a href="./" title="Data Wrangling" class="md-nav__link md-nav__link--active">
      Data Wrangling
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-analysis-in-r-the-datatable-way" title="Data Analysis in R, the data.table Way" class="md-nav__link">
    Data Analysis in R, the data.table Way
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-datatable-novice" title="1, data.table novice" class="md-nav__link">
    1, data.table novice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-datatable-yeoman" title="2, data.table yeoman" class="md-nav__link">
    2, data.table yeoman
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-datatable-expert" title="3, data.table expert" class="md-nav__link">
    3, data.table expert
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-manipulation-in-r-with-dplyr" title="Data Manipulation in R with dplyr" class="md-nav__link">
    Data Manipulation in R with dplyr
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-introduction-to-dplyr" title="1, Introduction to dplyr" class="md-nav__link">
    1, Introduction to dplyr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-select-and-mutate" title="2, select and mutate" class="md-nav__link">
    2, select and mutate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-filter-and-arrange" title="3, filter and arrange" class="md-nav__link">
    3, filter and arrange
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-summarise-and-the-pipe-operator" title="4, summarise and the Pipe Operator" class="md-nav__link">
    4, summarise and the Pipe Operator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-group_by-and-working-with-data" title="5, group_by and working with data" class="md-nav__link">
    5, group_by and working with data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-tidyr-functions" title="Adding tidyr Functions" class="md-nav__link">
    Adding tidyr Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extension-joining-data-in-r-with-dplyr" title="Extension: 'Joining Data in R with dplyr'" class="md-nav__link">
    Extension: 'Joining Data in R with dplyr'
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Plot Snippets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Plot Snippets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Plot_snippets_-_Basics/" title="Plot Snippets for Exploratory (and some Explanatory) Analyses" class="md-nav__link">
      Plot Snippets for Exploratory (and some Explanatory) Analyses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Plot_snippets_-_ggplot2/" title="Plot Snippets - ggplot2" class="md-nav__link">
      Plot Snippets - ggplot2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Plot_snippets_-_ggvis/" title="Plot Snippets - ggvis" class="md-nav__link">
      Plot Snippets - ggvis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Plot_snippets_-_Colours/" title="Plot Snippets - Colours" class="md-nav__link">
      Plot Snippets - Colours
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Packages
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Packages
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../googleVis/" title="googleVis (embed HTML plots)" class="md-nav__link">
      googleVis (embed HTML plots)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gganimate/" title="gganimate" class="md-nav__link">
      gganimate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fast-and-Frugal_Decision_Trees_in_R_with_FFTrees/" title="Fast-and-Frugal Decision Trees" class="md-nav__link">
      Fast-and-Frugal Decision Trees
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Big_Data_Analysis_with_Revolution_R_Enterprise/" title="Big Data Analysis with Revolution R Enterprise" class="md-nav__link">
      Big Data Analysis with Revolution R Enterprise
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Time Series in R The Power of xts and zoo/" title="Time Series in R, The Power of xts and zoo" class="md-nav__link">
      Time Series in R, The Power of xts and zoo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Parallel computing in R/" title="Parallel computing in R" class="md-nav__link">
      Parallel computing in R
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Other Snippets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Other Snippets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Tables/" title="Tables" class="md-nav__link">
      Tables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../embedding/" title="Embedding HTML into HTML" class="md-nav__link">
      Embedding HTML into HTML
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../embedding2/" title="Embedding Rmd into Rmd" class="md-nav__link">
      Embedding Rmd into Rmd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Frequentist_Bayesian/" title="Frequentist vs. Bayesian" class="md-nav__link">
      Frequentist vs. Bayesian
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      A Hands-on Introduction to Statistics with R
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        A Hands-on Introduction to Statistics with R
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../A_Hands-on_Introduction_to_Statistics_with_R,_Course_One,_Introduction/" title="Statistics with R, Course One, Introduction" class="md-nav__link">
      Statistics with R, Course One, Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../A_Hands-on_Introduction_to_Statistics_with_R,_Course_Two,_Student_s_T-test/" title="Statistics with R, Course Two, Student's t-test" class="md-nav__link">
      Statistics with R, Course Two, Student's t-test
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../A_Hands-on_Introduction_to_Statistics_with_R,_Course_Three,_Analysis_of_Variance/" title="Statistics with R, Course Three, Analysis of Variance" class="md-nav__link">
      Statistics with R, Course Three, Analysis of Variance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../A_Hands-on_Introduction_to_Statistics_with_R,_Course_Four,_Repeated_Measures_Anova/" title="Statistics with R, Course Four, Repeated Measures ANOVA" class="md-nav__link">
      Statistics with R, Course Four, Repeated Measures ANOVA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../A_Hands-on_Introduction_to_Statistics_with_R,_Course_Five,_Correlation_and_Regression/" title="Statistics with R, Course Five, Correlation and Regression" class="md-nav__link">
      Statistics with R, Course Five, Correlation and Regression
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../A_Hands-on_Introduction_to_Statistics_with_R,_Course_Six,_Multiple_Regression/" title="Statistics with R, Course Six, Multiple Regression" class="md-nav__link">
      Statistics with R, Course Six, Multiple Regression
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../A_Hands-on_Introduction_to_Statistics_with_R,_Course_Seven,_Moderation_and_Mediation/" title="Statistics with R, Course Seven, Moderation and Mediation" class="md-nav__link">
      Statistics with R, Course Seven, Moderation and Mediation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../A_Hands-on_Introduction_to_Statistics_with_R,_Notes/" title="Statistics with R, Notes" class="md-nav__link">
      Statistics with R, Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-analysis-in-r-the-datatable-way" title="Data Analysis in R, the data.table Way" class="md-nav__link">
    Data Analysis in R, the data.table Way
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-datatable-novice" title="1, data.table novice" class="md-nav__link">
    1, data.table novice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-datatable-yeoman" title="2, data.table yeoman" class="md-nav__link">
    2, data.table yeoman
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-datatable-expert" title="3, data.table expert" class="md-nav__link">
    3, data.table expert
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-manipulation-in-r-with-dplyr" title="Data Manipulation in R with dplyr" class="md-nav__link">
    Data Manipulation in R with dplyr
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-introduction-to-dplyr" title="1, Introduction to dplyr" class="md-nav__link">
    1, Introduction to dplyr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-select-and-mutate" title="2, select and mutate" class="md-nav__link">
    2, select and mutate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-filter-and-arrange" title="3, filter and arrange" class="md-nav__link">
    3, filter and arrange
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-summarise-and-the-pipe-operator" title="4, summarise and the Pipe Operator" class="md-nav__link">
    4, summarise and the Pipe Operator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-group_by-and-working-with-data" title="5, group_by and working with data" class="md-nav__link">
    5, group_by and working with data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-tidyr-functions" title="Adding tidyr Functions" class="md-nav__link">
    Adding tidyr Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extension-joining-data-in-r-with-dplyr" title="Extension: 'Joining Data in R with dplyr'" class="md-nav__link">
    Extension: 'Joining Data in R with dplyr'
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ugoproto/ugo_r_doc.git/edit/master/docs/Data_Wrangling.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Data Wrangling</h1>
                
                <!--

-   [Documentation](#documentation)
-   [Data Analysis in R, the `data.table` Way](#data-analysis-in-r-the-data.table-way)
    -   [1, `data.table` novice](#data.table-novice)
    -   [2, `data.table` yeoman](#data.table-yeoman)
    -   [3, `data.table` expert](#data.table-expert)
-   [Data Manipulation in R with `dplyr`](#data-manipulation-in-r-with-dplyr)
    -   [1, Introduction to `dplyr`](#introduction-to-dplyr)
    -   [2, `select` and `mutate`](#select-and-mutate)
    -   [3, `filter` and `arrange`](#filter-and-arrange)
    -   [4, `summarise` and the Pipe Operator](#summarise-and-the-pipe-operator)
    -   [5, `group_by` and working with data](#group_by-and-working-with-data)
-   [Adding `tidyr` Functions](#adding-tidyr-functions)
-   [Extension: 'Joining Data in R with `dplyr`'](#extension-joining-data-in-r-with-dplyr)
-->

<hr />
<p><strong>Foreword</strong></p>
<ul>
<li>Output options: the &lsquo;tango&rsquo; syntax and the &lsquo;readable&rsquo; theme.</li>
<li>Snippets and results.</li>
</ul>
<hr />
<h4 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h4>
<p><code class="codehilite">data.table</code></p>
<ul>
<li>extension of <code class="codehilite">data.frame</code>.</li>
<li>Fast aggregation of large data (e.g. 100GB in RAM), fast ordered<br />
    joins, fast add/modify/delete of columns by group using no copies at<br />
    all, list columns, a fast friendly file reader and parallel<br />
    file writer. Offers a natural and flexible syntax, for<br />
    faster development.</li>
</ul>
<p><code class="codehilite">dplyr</code></p>
<ul>
<li>A fast, consistent tool for working with data frame like objects,<br />
    both in memory and out of memory.</li>
<li>Pipelines.</li>
</ul>
<p><code class="codehilite">tidyr</code></p>
<ul>
<li>An evolution of &lsquo;reshape2&rsquo;. It&rsquo;s designed specifically for data<br />
    tidying (not general reshaping or aggregating) and works well with<br />
    dplyr data pipelines.</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">package</th>
<th align="left">'narrower'</th>
<th align="left">'wider'</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>tidyr</code></td>
<td align="left">gather</td>
<td align="left">spread</td>
</tr>
<tr class="even">
<td align="left"><code>reshape2</code></td>
<td align="left">melt</td>
<td align="left">cast</td>
</tr>
<tr class="odd">
<td align="left">spreadsheets</td>
<td align="left">unpivot</td>
<td align="left">pivot</td>
</tr>
<tr class="even">
<td align="left">databases</td>
<td align="left">fold</td>
<td align="left">unfold</td>
</tr>
</tbody>
</table>

<h3 id="data-analysis-in-r-the-datatable-way">Data Analysis in R, the <code class="codehilite">data.table</code> Way<a class="headerlink" href="#data-analysis-in-r-the-datatable-way" title="Permanent link">&para;</a></h3>
<h4 id="1-datatable-novice">1, <code class="codehilite">data.table</code> novice<a class="headerlink" href="#1-datatable-novice" title="Permanent link">&para;</a></h4>
<p>Find out more with <code class="codehilite">?data.table</code>.</p>
<p><strong>Create and subset a <code class="codehilite">data.table</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># The data.table package</span>
<span class="kn">library</span><span class="p">(</span>data.table<span class="p">)</span>

<span class="c1"># Create my_first_data_table</span>
my_first_data_table <span class="o">&lt;-</span> data.table<span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">),</span> y <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">))</span>

<span class="c1"># Create a data.table using recycling</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>a <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> b <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">))</span>

<span class="c1"># Print the third row to the console</span>
DT<span class="p">[</span><span class="m">3</span><span class="p">,]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: 1 C
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print the second and third row to the console, but do not commas</span>
DT<span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: 2 B
## 2: 1 C
</pre></div>
</td></tr></table>

<p><strong>Getting to know a <code class="codehilite">data.table</code></strong></p>
<p>Like <code class="codehilite">head</code>, <code class="codehilite">tail</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print the penultimate row of DT using .N</span>
DT<span class="p">[</span><span class="m">.</span>N <span class="o">-</span> <span class="m">1</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: 1 C
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print the column names of DT, and number of rows and number of columns</span>
<span class="kp">colnames</span><span class="p">(</span>DT<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## [1] &quot;a&quot; &quot;b&quot;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kp">dim</span><span class="p">(</span>DT<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## [1] 4 2
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Select row 2 twice and row 3, returning a data.table with three rows where row 2 is a duplicate of row 1.</span>
DT<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: 2 B
## 2: 2 B
## 3: 1 C
</pre></div>
</td></tr></table>

<p><code class="codehilite">DT</code> is a data.table/data.frame, but <code class="codehilite">DT[ , B]</code> is a vector;<br />
<code class="codehilite">DT[ , .(B)]</code> is a subsetted data.table.</p>
<p><strong>Subsetting data tables</strong></p>
<p><code class="codehilite">DT[i, j, by]</code> means take <code class="codehilite">DT</code>, subset rows using <code class="codehilite">i</code>, then calculate<br />
<code class="codehilite">j</code> grouped by <code class="codehilite">by</code>. You can wrap <code class="codehilite">j</code> with <code class="codehilite">.()</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>A <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
B <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">)</span>
C <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>A<span class="p">,</span> B<span class="p">,</span> C<span class="p">)</span>

<span class="c1"># Subset rows 1 and 3, and columns B and C</span>
DT<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="p">,</span><span class="m">.</span><span class="p">(</span>B<span class="p">,</span> C<span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    B C
## 1: a 6
## 2: c 8
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Assign to ans the correct value</span>
ans <span class="o">&lt;-</span> data.table<span class="p">(</span>DT<span class="p">[,</span> <span class="m">.</span><span class="p">(</span>B<span class="p">,</span> val <span class="o">=</span> A <span class="o">*</span> C<span class="p">)])</span>

<span class="c1"># Fill in the blanks such that ans2 equals target</span>
<span class="c1">#target &lt;- data.table(B = c(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;),  val = as.integer(c(6:10, 1:5)))</span>
ans2 <span class="o">&lt;-</span> data.table<span class="p">(</span>DT<span class="p">[,</span> <span class="m">.</span><span class="p">(</span>B<span class="p">,</span> val <span class="o">=</span> <span class="kp">as.integer</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">6</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)))])</span>
</pre></div>
</td></tr></table>

<p><strong>The <code class="codehilite">by</code> basics</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># iris and iris3 are already available in the workspace</span>

<span class="c1"># Convert iris to a data.table: DT</span>
DT <span class="o">&lt;-</span> as.data.table<span class="p">(</span>iris<span class="p">)</span>

<span class="c1"># For each Species, print the mean Sepal.Length</span>
DT<span class="p">[,</span> <span class="m">.</span><span class="p">(</span><span class="kp">mean</span><span class="p">(</span>Sepal.Length<span class="p">)),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>Species<span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##       Species    V1
## 1:     setosa 5.006
## 2: versicolor 5.936
## 3:  virginica 6.588
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print mean Sepal.Length, grouping by first letter of Species</span>
DT<span class="p">[,</span> <span class="m">.</span><span class="p">(</span><span class="kp">mean</span><span class="p">(</span>Sepal.Length<span class="p">)),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span><span class="kp">substr</span><span class="p">(</span>Species<span class="p">,</span> <span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    substr    V1
## 1:      s 5.006
## 2:      v 6.262
</pre></div>
</td></tr></table>

<p><strong>Using <code class="codehilite"><span class="na">.N</span></code> and <code class="codehilite">by</code></strong></p>
<p><code class="codehilite"><span class="na">.N</span></code>, number, in row or column.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># data.table version of iris: DT</span>
DT <span class="o">&lt;-</span> as.data.table<span class="p">(</span>iris<span class="p">)</span>

<span class="c1"># Group the specimens by Sepal area (to the nearest 10 cm2) and count how many occur in each group.</span>
DT<span class="p">[,</span> <span class="m">.</span>N<span class="p">,</span> by <span class="o">=</span> <span class="m">10</span> <span class="o">*</span> <span class="kp">round</span><span class="p">(</span>Sepal.Length <span class="o">*</span> Sepal.Width <span class="o">/</span> <span class="m">10</span><span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    round   N
## 1:    20 117
## 2:    10  29
## 3:    30   4
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Now name the output columns `Area` and `Count`</span>
DT<span class="p">[,</span> <span class="m">.</span><span class="p">(</span>Count <span class="o">=</span> <span class="m">.</span>N<span class="p">),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>Area <span class="o">=</span> <span class="m">10</span> <span class="o">*</span> <span class="kp">round</span><span class="p">(</span>Sepal.Length <span class="o">*</span> Sepal.Width <span class="o">/</span> <span class="m">10</span><span class="p">))]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    Area Count
## 1:   20   117
## 2:   10    29
## 3:   30     4
</pre></div>
</td></tr></table>

<p><strong>Return multiple numbers in <code class="codehilite">j</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Create the data.table DT</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>A <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="kc">letters</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">1</span><span class="p">],</span> each <span class="o">=</span> <span class="m">4L</span><span class="p">),</span> B <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> each <span class="o">=</span> <span class="m">2L</span><span class="p">),</span> C <span class="o">=</span> <span class="kp">sample</span><span class="p">(</span><span class="m">8</span><span class="p">))</span>

<span class="c1"># Create the new data.table, DT2</span>
DT2 <span class="o">&lt;-</span> DT<span class="p">[,</span> <span class="m">.</span><span class="p">(</span>C <span class="o">=</span> <span class="kp">cumsum</span><span class="p">(</span>C<span class="p">)),</span> by<span class="o">=</span><span class="m">.</span><span class="p">(</span>A<span class="p">,</span>B<span class="p">)]</span>

<span class="c1"># Select from DT2 the last two values from C while you group by A</span>
DT2<span class="p">[,</span> <span class="m">.</span><span class="p">(</span>C <span class="o">=</span> <span class="kp">tail</span><span class="p">(</span>C<span class="p">,</span><span class="m">2</span><span class="p">)),</span> by<span class="o">=</span>A<span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A C
## 1: b 4
## 2: b 9
## 3: a 2
## 4: a 8
</pre></div>
</td></tr></table>

<h4 id="2-datatable-yeoman">2, <code class="codehilite">data.table</code> yeoman<a class="headerlink" href="#2-datatable-yeoman" title="Permanent link">&para;</a></h4>
<p><strong>Chaining, the basics</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Build DT</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>A <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="kc">letters</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">1</span><span class="p">],</span> each <span class="o">=</span> <span class="m">4L</span><span class="p">),</span> B <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> each <span class="o">=</span> <span class="m">2L</span><span class="p">),</span> C <span class="o">=</span> <span class="kp">sample</span><span class="p">(</span><span class="m">8</span><span class="p">))</span> 
DT
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B C
## 1: b 1 3
## 2: b 1 8
## 3: b 2 4
## 4: b 2 5
## 5: a 3 1
## 6: a 3 7
## 7: a 4 2
## 8: a 4 6
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Use chaining</span>
<span class="c1"># Cumsum of C while grouping by A and B, and then select last two values of C while grouping by A</span>
DT<span class="p">[,</span> <span class="m">.</span><span class="p">(</span>C <span class="o">=</span> <span class="kp">cumsum</span><span class="p">(</span>C<span class="p">)),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>A<span class="p">,</span>B<span class="p">)][,</span> <span class="m">.</span><span class="p">(</span>C <span class="o">=</span> <span class="kp">tail</span><span class="p">(</span>C<span class="p">,</span><span class="m">2</span><span class="p">)),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>A<span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A C
## 1: b 4
## 2: b 9
## 3: a 2
## 4: a 8
</pre></div>
</td></tr></table>

<p><strong>Chaining your <code class="codehilite">iris</code> dataset</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>DT <span class="o">&lt;-</span> data.table<span class="p">(</span>iris<span class="p">)</span>

<span class="c1"># Perform chained operations on DT</span>
DT<span class="p">[,</span> <span class="m">.</span><span class="p">(</span>Sepal.Length <span class="o">=</span> median<span class="p">(</span>Sepal.Length<span class="p">),</span> Sepal.Width <span class="o">=</span> median<span class="p">(</span>Sepal.Width<span class="p">),</span> Petal.Length <span class="o">=</span> median<span class="p">(</span>Petal.Length<span class="p">),</span> Petal.Width <span class="o">=</span> median<span class="p">(</span>Petal.Width<span class="p">)),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>Species<span class="p">)][</span><span class="kp">order</span><span class="p">(</span>Species<span class="p">,</span> decreasing <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##       Species Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1:  virginica          6.5         3.0         5.55         2.0
## 2: versicolor          5.9         2.8         4.35         1.3
## 3:     setosa          5.0         3.4         1.50         0.2
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>DT
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4         0.2    setosa
##   2:          4.9         3.0          1.4         0.2    setosa
##   3:          4.7         3.2          1.3         0.2    setosa
##   4:          4.6         3.1          1.5         0.2    setosa
##   5:          5.0         3.6          1.4         0.2    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2         2.3 virginica
## 147:          6.3         2.5          5.0         1.9 virginica
## 148:          6.5         3.0          5.2         2.0 virginica
## 149:          6.2         3.4          5.4         2.3 virginica
## 150:          5.9         3.0          5.1         1.8 virginica
</pre></div>
</td></tr></table>

<p><strong>Programming time vs readability</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>x <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
y <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">13</span><span class="p">)</span>
z <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">14</span><span class="p">)</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> z<span class="p">)</span>

<span class="c1"># Mean of columns</span>
DT<span class="p">[,</span> <span class="kp">lapply</span><span class="p">(</span><span class="m">.</span>SD<span class="p">,</span> <span class="kp">mean</span><span class="p">),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>x<span class="p">)]</span> 
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    x        y        z
## 1: 2 6.500000 7.500000
## 2: 1 7.666667 8.666667
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Median of columns</span>
DT<span class="p">[,</span> <span class="kp">lapply</span><span class="p">(</span><span class="m">.</span>SD<span class="p">,</span> median<span class="p">),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>x<span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    x y z
## 1: 2 7 8
## 2: 1 7 8
</pre></div>
</td></tr></table>

<p><strong>Introducing <code class="codehilite"><span class="na">.SDcols</span></code></strong></p>
<p><code class="codehilite"><span class="na">.SDcols</span></code> specifies the columns of <code class="codehilite">DT</code> that are included in <code class="codehilite"><span class="na">.SD</span></code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>grp <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">)</span>
Q1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
Q2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
Q3 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
H1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
H2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>grp<span class="p">,</span> Q1<span class="p">,</span> Q2<span class="p">,</span> Q3<span class="p">,</span> H1<span class="p">,</span> H2<span class="p">)</span>

<span class="c1"># Calculate the sum of the Q columns</span>
DT<span class="p">[,</span> <span class="kp">lapply</span><span class="p">(</span><span class="m">.</span>SD<span class="p">,</span> <span class="kp">sum</span><span class="p">),</span> <span class="m">.</span>SDcols <span class="o">=</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    Q1 Q2 Q3
## 1: 18 14 16
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Calculate the sum of columns H1 and H2 </span>
DT<span class="p">[,</span> <span class="kp">lapply</span><span class="p">(</span><span class="m">.</span>SD<span class="p">,</span> <span class="kp">sum</span><span class="p">),</span> <span class="m">.</span>SDcols <span class="o">=</span> <span class="m">5</span><span class="o">:</span><span class="m">6</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    H1 H2
## 1: 12 15
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Select all but the first row of groups 1 and 2, returning only the grp column and the Q columns. </span>
DT<span class="p">[,</span> <span class="m">.</span>SD<span class="p">[</span><span class="m">-1</span><span class="p">],</span> <span class="m">.</span>SDcols <span class="o">=</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>grp<span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    grp Q1 Q2 Q3
## 1:   6  3  4  1
## 2:   8  5  4  5
## 3:   8  3  4  2
</pre></div>
</td></tr></table>

<p><strong>Mixing it together: <code class="codehilite">lapply</code>, <code class="codehilite"><span class="na">.SD</span></code>, <code class="codehilite">SDcols</code> and <code class="codehilite"><span class="na">.N</span></code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>x <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
y <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">13</span><span class="p">)</span>
z <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">14</span><span class="p">)</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> z<span class="p">)</span>

<span class="c1"># Sum of all columns and the number of rows</span>
<span class="c1"># For the first part, you need to combine the returned list from lapply, .SD and .SDcols and the integer vector of .N. You have to this because the result of the two together has to be a list again, with all values put together.</span>
DT
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    x  y  z
## 1: 2  1  2
## 2: 1  3  4
## 3: 2  5  6
## 4: 1  7  8
## 5: 2  9 10
## 6: 2 11 12
## 7: 1 13 14
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>DT<span class="p">[,</span><span class="kt">c</span><span class="p">(</span><span class="kp">lapply</span><span class="p">(</span><span class="m">.</span>SD<span class="p">,</span> <span class="kp">sum</span><span class="p">),</span> <span class="m">.</span>N<span class="p">),</span> <span class="m">.</span>SDcols <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> by <span class="o">=</span> x<span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    x x  y  z N
## 1: 2 8 26 30 4
## 2: 1 3 23 26 3
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Cumulative sum of column x and y while grouping by x and z &gt; 8</span>
DT<span class="p">[,</span><span class="kp">lapply</span><span class="p">(</span><span class="m">.</span>SD<span class="p">,</span> <span class="kp">cumsum</span><span class="p">),</span> <span class="m">.</span>SDcols <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>by1 <span class="o">=</span> x<span class="p">,</span> by2 <span class="o">=</span> z <span class="o">&gt;</span> <span class="m">8</span><span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    by1   by2 x  y
## 1:   2 FALSE 2  1
## 2:   2 FALSE 4  6
## 3:   1 FALSE 1  3
## 4:   1 FALSE 2 10
## 5:   2  TRUE 2  9
## 6:   2  TRUE 4 20
## 7:   1  TRUE 1 13
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Chaining</span>
DT<span class="p">[,</span><span class="kp">lapply</span><span class="p">(</span><span class="m">.</span>SD<span class="p">,</span> <span class="kp">cumsum</span><span class="p">),</span> <span class="m">.</span>SDcols <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>by1 <span class="o">=</span> x<span class="p">,</span> by2 <span class="o">=</span> z <span class="o">&gt;</span> <span class="m">8</span><span class="p">)][,</span><span class="kp">lapply</span><span class="p">(</span><span class="m">.</span>SD<span class="p">,</span> <span class="kp">max</span><span class="p">),</span> <span class="m">.</span>SDcols <span class="o">=</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> by <span class="o">=</span> by1<span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    by1 x  y
## 1:   2 4 20
## 2:   1 2 13
</pre></div>
</td></tr></table>

<p><strong>Adding, updating and removing columns</strong></p>
<p><code class="codehilite">:=</code> is defined for use in <code class="codehilite">j</code> only.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># The data.table DT</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>A <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)],</span> B <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>
DT
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B
## 1: a 1
## 2: a 2
## 3: a 3
## 4: b 4
## 5: b 5
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add column by reference: Total</span>
DT<span class="p">[,</span> <span class="p">(</span><span class="s">&#39;Total&#39;</span><span class="p">)</span> <span class="o">:=</span> <span class="kp">sum</span><span class="p">(</span>B<span class="p">),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>A<span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B Total
## 1: a 1     6
## 2: a 2     6
## 3: a 3     6
## 4: b 4     9
## 5: b 5     9
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add 1 to column B</span>
DT<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span> <span class="o">:=</span> <span class="kp">as.integer</span><span class="p">(</span><span class="m">1</span> <span class="o">+</span> B<span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B Total
## 1: a 1     6
## 2: a 3     6
## 3: a 3     6
## 4: b 5     9
## 5: b 5     9
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add a new column Total2</span>
DT<span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="s">&#39;:=&#39;</span><span class="p">(</span>Total2 <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span>B<span class="p">)),</span> by <span class="o">=</span> <span class="m">.</span><span class="p">(</span>A<span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B Total Total2
## 1: a 1     6     NA
## 2: a 3     6      6
## 3: a 3     6      6
## 4: b 5     9      5
## 5: b 5     9     NA
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Remove the Total column</span>
DT<span class="p">[,</span> Total <span class="o">:=</span> <span class="kc">NULL</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B Total2
## 1: a 1     NA
## 2: a 3      6
## 3: a 3      6
## 4: b 5      5
## 5: b 5     NA
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Select the third column using `[[`</span>
DT<span class="p">[[</span><span class="m">3</span><span class="p">]]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## [1] NA  6  6  5 NA
</pre></div>
</td></tr></table>

<p><strong>The functional form</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># A data.table DT</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>A <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> B <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>

<span class="c1"># Update B, add C and D</span>
DT<span class="p">[,</span> <span class="sb">`:=`</span><span class="p">(</span>B <span class="o">=</span> B <span class="o">+</span> <span class="m">1</span><span class="p">,</span>  C <span class="o">=</span> A <span class="o">+</span> B<span class="p">,</span> D <span class="o">=</span> <span class="m">2</span><span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B C D
## 1: 1 2 2 2
## 2: 1 3 3 2
## 3: 1 4 4 2
## 4: 2 5 6 2
## 5: 2 6 7 2
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Delete my_cols</span>
my_cols <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">)</span>
DT<span class="p">[,</span> <span class="p">(</span>my_cols<span class="p">)</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A D
## 1: 1 2
## 2: 1 2
## 3: 1 2
## 4: 2 2
## 5: 2 2
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Delete column 2 by number</span>
DT<span class="p">[,</span> <span class="m">2</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A
## 1: 1
## 2: 1
## 3: 1
## 4: 2
## 5: 2
</pre></div>
</td></tr></table>

<p><strong>Ready, <code class="codehilite">set</code>, go!</strong></p>
<p>The <code class="codehilite">set</code> function is used to repeatedly update a data.table by<br />
reference. You can think of the <code class="codehilite">set</code> function as a loopable.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>A <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
B <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
C <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
D <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>A<span class="p">,</span> B<span class="p">,</span> C<span class="p">,</span> D<span class="p">)</span>

<span class="c1"># Set the seed</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>

<span class="c1"># Check the DT</span>
DT
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     A B C D
##  1: 2 2 5 3
##  2: 2 1 2 3
##  3: 3 4 4 3
##  4: 5 2 1 1
##  5: 2 4 2 5
##  6: 5 3 2 4
##  7: 5 4 1 4
##  8: 4 5 2 1
##  9: 4 2 5 4
## 10: 1 4 2 3
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># For loop with set</span>
<span class="kr">for</span> <span class="p">(</span>l <span class="kr">in</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">)</span> set<span class="p">(</span>DT<span class="p">,</span> <span class="kp">sample</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">3</span><span class="p">),</span> l<span class="p">,</span> <span class="kc">NA</span><span class="p">)</span>

<span class="c1"># Change the column names to lowercase</span>
setnames<span class="p">(</span>DT<span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">))</span>

<span class="c1"># Print the resulting DT to the console</span>
DT
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     a  b  c  d
##  1: 2  2  5  3
##  2: 2  1 NA  3
##  3: 3 NA  4  3
##  4: 5 NA  1  1
##  5: 2 NA  2  5
##  6: 5  3  2 NA
##  7: 5  4  1  4
##  8: 4  5 NA  1
##  9: 4  2  5 NA
## 10: 1  4 NA NA
</pre></div>
</td></tr></table>

<p><strong>The <code class="codehilite">set</code> family</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Define DT</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>a <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)],</span> b <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
DT
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a b
## 1: a 1
## 2: a 1
## 3: a 1
## 4: b 1
## 5: b 1
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add a postfix &#39;_2&#39; to all column names</span>
setnames<span class="p">(</span>DT<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">),</span> <span class="kp">paste0</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">),</span> <span class="s">&#39;_2&#39;</span><span class="p">))</span>
DT
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    a_2 b_2
## 1:   a   1
## 2:   a   1
## 3:   a   1
## 4:   b   1
## 5:   b   1
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Change column name &#39;a_2&#39; to &#39;A2&#39;</span>
setnames<span class="p">(</span>DT<span class="p">,</span> <span class="s">&#39;a_2&#39;</span><span class="p">,</span> <span class="s">&#39;A2&#39;</span><span class="p">)</span>
DT
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A2 b_2
## 1:  a   1
## 2:  a   1
## 3:  a   1
## 4:  b   1
## 5:  b   1
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Reverse the order of the columns</span>
setcolorder<span class="p">(</span>DT<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;b_2&#39;</span><span class="p">,</span><span class="s">&#39;A2&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<h4 id="3-datatable-expert">3, <code class="codehilite">data.table</code> expert<a class="headerlink" href="#3-datatable-expert" title="Permanent link">&para;</a></h4>
<p><strong>Selecting rows the <code class="codehilite">data.table</code> way</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Convert iris to a data.table</span>
iris <span class="o">&lt;-</span> data.table<span class="p">(</span><span class="s">&#39;Sepal.Length&#39;</span> <span class="o">=</span> iris<span class="o">$</span>Sepal.Length<span class="p">,</span> <span class="s">&#39;Sepal.Width&#39;</span> <span class="o">=</span> iris<span class="o">$</span>Sepal.Width<span class="p">,</span> <span class="s">&#39;Petal.Length&#39;</span> <span class="o">=</span> iris<span class="o">$</span>Petal.Length<span class="p">,</span> <span class="s">&#39;Petal.Width&#39;</span> <span class="o">=</span> iris<span class="o">$</span>Petal.Width<span class="p">,</span> <span class="s">&#39;Species&#39;</span> <span class="o">=</span> iris<span class="o">$</span>Species<span class="p">)</span>
iris
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4         0.2    setosa
##   2:          4.9         3.0          1.4         0.2    setosa
##   3:          4.7         3.2          1.3         0.2    setosa
##   4:          4.6         3.1          1.5         0.2    setosa
##   5:          5.0         3.6          1.4         0.2    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2         2.3 virginica
## 147:          6.3         2.5          5.0         1.9 virginica
## 148:          6.5         3.0          5.2         2.0 virginica
## 149:          6.2         3.4          5.4         2.3 virginica
## 150:          5.9         3.0          5.1         1.8 virginica
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Species is &#39;virginica&#39;</span>
<span class="kp">head</span><span class="p">(</span>iris<span class="p">[</span>Species <span class="o">==</span> <span class="s">&#39;virginica&#39;</span><span class="p">],</span> <span class="m">20</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##  1:          6.3         3.3          6.0         2.5 virginica
##  2:          5.8         2.7          5.1         1.9 virginica
##  3:          7.1         3.0          5.9         2.1 virginica
##  4:          6.3         2.9          5.6         1.8 virginica
##  5:          6.5         3.0          5.8         2.2 virginica
##  6:          7.6         3.0          6.6         2.1 virginica
##  7:          4.9         2.5          4.5         1.7 virginica
##  8:          7.3         2.9          6.3         1.8 virginica
##  9:          6.7         2.5          5.8         1.8 virginica
## 10:          7.2         3.6          6.1         2.5 virginica
## 11:          6.5         3.2          5.1         2.0 virginica
## 12:          6.4         2.7          5.3         1.9 virginica
## 13:          6.8         3.0          5.5         2.1 virginica
## 14:          5.7         2.5          5.0         2.0 virginica
## 15:          5.8         2.8          5.1         2.4 virginica
## 16:          6.4         3.2          5.3         2.3 virginica
## 17:          6.5         3.0          5.5         1.8 virginica
## 18:          7.7         3.8          6.7         2.2 virginica
## 19:          7.7         2.6          6.9         2.3 virginica
## 20:          6.0         2.2          5.0         1.5 virginica
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Species is either &#39;virginica&#39; or &#39;versicolor&#39;</span>
<span class="kp">head</span><span class="p">(</span>iris<span class="p">[</span>Species <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;virginica&#39;</span><span class="p">,</span> <span class="s">&#39;versicolor&#39;</span><span class="p">)],</span> <span class="m">20</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
##  1:          7.0         3.2          4.7         1.4 versicolor
##  2:          6.4         3.2          4.5         1.5 versicolor
##  3:          6.9         3.1          4.9         1.5 versicolor
##  4:          5.5         2.3          4.0         1.3 versicolor
##  5:          6.5         2.8          4.6         1.5 versicolor
##  6:          5.7         2.8          4.5         1.3 versicolor
##  7:          6.3         3.3          4.7         1.6 versicolor
##  8:          4.9         2.4          3.3         1.0 versicolor
##  9:          6.6         2.9          4.6         1.3 versicolor
## 10:          5.2         2.7          3.9         1.4 versicolor
## 11:          5.0         2.0          3.5         1.0 versicolor
## 12:          5.9         3.0          4.2         1.5 versicolor
## 13:          6.0         2.2          4.0         1.0 versicolor
## 14:          6.1         2.9          4.7         1.4 versicolor
## 15:          5.6         2.9          3.6         1.3 versicolor
## 16:          6.7         3.1          4.4         1.4 versicolor
## 17:          5.6         3.0          4.5         1.5 versicolor
## 18:          5.8         2.7          4.1         1.0 versicolor
## 19:          6.2         2.2          4.5         1.5 versicolor
## 20:          5.6         2.5          3.9         1.1 versicolor
</pre></div>
</td></tr></table>

<p><strong>Removing columns and adapting your column names</strong></p>
<p>Refer to a regex cheat sheet for metacharacter.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># iris as a data.table</span>
iris <span class="o">&lt;-</span> as.data.table<span class="p">(</span>iris<span class="p">)</span>
iris
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
##   1:          5.1         3.5          1.4         0.2    setosa
##   2:          4.9         3.0          1.4         0.2    setosa
##   3:          4.7         3.2          1.3         0.2    setosa
##   4:          4.6         3.1          1.5         0.2    setosa
##   5:          5.0         3.6          1.4         0.2    setosa
##  ---                                                            
## 146:          6.7         3.0          5.2         2.3 virginica
## 147:          6.3         2.5          5.0         1.9 virginica
## 148:          6.5         3.0          5.2         2.0 virginica
## 149:          6.2         3.4          5.4         2.3 virginica
## 150:          5.9         3.0          5.1         1.8 virginica
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Remove the &#39;Sepal.&#39; prefix</span>
<span class="c1">#gsub(&#39;([ab])&#39;, &#39;\\1_\\1_&#39;, &#39;abc and ABC&#39;) = pattern, replacement, x</span>
setnames<span class="p">(</span>iris<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;Sepal.Length&#39;</span><span class="p">,</span> <span class="s">&#39;Sepal.Width&#39;</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;Length&#39;</span><span class="p">,</span><span class="s">&#39;Width&#39;</span><span class="p">))</span> 
<span class="c1">#gsub(&#39;^Sepal\\.&#39;,&#39;&#39;, iris)</span>

<span class="c1"># Remove the two columns starting with &#39;Petal&#39;</span>
iris<span class="p">[,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;Petal.Length&#39;</span><span class="p">,</span> <span class="s">&#39;Petal.Width&#39;</span><span class="p">)</span> <span class="o">:=</span> <span class="kc">NULL</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##      Length Width   Species
##   1:    5.1   3.5    setosa
##   2:    4.9   3.0    setosa
##   3:    4.7   3.2    setosa
##   4:    4.6   3.1    setosa
##   5:    5.0   3.6    setosa
##  ---                       
## 146:    6.7   3.0 virginica
## 147:    6.3   2.5 virginica
## 148:    6.5   3.0 virginica
## 149:    6.2   3.4 virginica
## 150:    5.9   3.0 virginica
</pre></div>
</td></tr></table>

<p><strong>Understanding automatic indexing</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Cleaned up iris data.table</span>
iris2 <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>Length <span class="o">=</span> iris<span class="o">$</span>Sepal.Length<span class="p">,</span> Width <span class="o">=</span> iris<span class="o">$</span>Sepal.Width<span class="p">,</span> Species <span class="o">=</span> iris<span class="o">$</span>Species<span class="p">)</span>
iris2 <span class="o">&lt;-</span> as.data.table<span class="p">(</span>iris2<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Area is greater than 20 square centimeters</span>
iris2<span class="p">[</span> Width <span class="o">*</span> Length <span class="o">&gt;</span> <span class="m">20</span> <span class="p">],</span> <span class="m">20</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>   Length Width    Species is_large
 1:    5.4   3.9     setosa    FALSE
 2:    5.8   4.0     setosa    FALSE
 3:    5.7   4.4     setosa     TRUE
 4:    5.4   3.9     setosa    FALSE
 5:    5.7   3.8     setosa    FALSE
 6:    5.2   4.1     setosa    FALSE
 7:    5.5   4.2     setosa    FALSE
 8:    7.0   3.2 versicolor    FALSE
 9:    6.4   3.2 versicolor    FALSE
10:    6.9   3.1 versicolor    FALSE
11:    6.3   3.3 versicolor    FALSE
12:    6.7   3.1 versicolor    FALSE
13:    6.7   3.0 versicolor    FALSE
14:    6.0   3.4 versicolor    FALSE
15:    6.7   3.1 versicolor    FALSE
16:    6.3   3.3  virginica    FALSE
17:    7.1   3.0  virginica    FALSE
18:    7.6   3.0  virginica    FALSE
19:    7.3   2.9  virginica    FALSE
20:    7.2   3.6  virginica     TRUE
...
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add new boolean column</span>
iris2<span class="p">[,</span> is_large <span class="o">:=</span> Width <span class="o">*</span> Length <span class="o">&gt;</span> <span class="m">25</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Now large observations with is_large</span>
iris2<span class="p">[</span>is_large <span class="o">==</span> <span class="kc">TRUE</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>   Length Width   Species is_large
1:    5.7   4.4    setosa     TRUE
2:    7.2   3.6 virginica     TRUE
3:    7.7   3.8 virginica     TRUE
4:    7.9   3.8 virginica     TRUE
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>iris2<span class="p">[(</span>is_large<span class="p">)]</span> <span class="c1"># Also OK</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>   Length Width   Species is_large
1:    5.7   4.4    setosa     TRUE
2:    7.2   3.6 virginica     TRUE
3:    7.7   3.8 virginica     TRUE
4:    7.9   3.8 virginica     TRUE
</pre></div>
</td></tr></table>

<p><strong>Selecting groups or parts of groups</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># The &#39;keyed&#39; data.table DT</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>A <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)],</span>
                 B <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span><span class="m">8</span> <span class="p">,</span><span class="m">8</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> 
                 C <span class="o">=</span> <span class="m">6</span><span class="o">:</span><span class="m">12</span><span class="p">)</span>
setkey<span class="p">(</span>DT<span class="p">,</span> A<span class="p">,</span> B<span class="p">)</span>

<span class="c1"># Select the &#39;b&#39; group</span>
DT<span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 1  8
## 2: b 5  6
## 3: b 8 11
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># &#39;b&#39; and &#39;c&#39; groups</span>
DT<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 1  8
## 2: b 5  6
## 3: b 8 11
## 4: c 6 12
## 5: c 9  9
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># The first row of the &#39;b&#39; and &#39;c&#39; groups</span>
DT<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> mult <span class="o">=</span> <span class="s">&#39;first&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 1  8
## 2: c 6 12
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># First and last row of the &#39;b&#39; and &#39;c&#39; groups</span>
DT<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> <span class="m">.</span>SD<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">.</span>N<span class="p">)],</span> by <span class="o">=</span> <span class="m">.</span>EACHI<span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 1  8
## 2: b 8 11
## 3: c 6 12
## 4: c 9  9
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Copy and extend code for instruction 4: add printout</span>
DT<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">),</span> <span class="p">{</span> <span class="kp">print</span><span class="p">(</span><span class="m">.</span>SD<span class="p">);</span> <span class="m">.</span>SD<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">.</span>N<span class="p">)]</span> <span class="p">},</span> by <span class="o">=</span> <span class="m">.</span>EACHI<span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    B  C
## 1: 1  8
## 2: 5  6
## 3: 8 11
##    B  C
## 1: 6 12
## 2: 9  9

##    A B  C
## 1: b 1  8
## 2: b 8 11
## 3: c 6 12
## 4: c 9  9
</pre></div>
</td></tr></table>

<p><strong>Rolling joins - part one</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Keyed data.table DT</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>A <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)],</span>                  B <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> 
                 C <span class="o">=</span> <span class="m">6</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> 
                 key <span class="o">=</span> <span class="s">&#39;A,B&#39;</span><span class="p">)</span>

<span class="c1"># Get the key of DT</span>
key<span class="p">(</span>DT<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## [1] &quot;A&quot; &quot;B&quot;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Row where A == &#39;b&#39; &amp; B == 6</span>
setkey<span class="p">(</span>DT<span class="p">,</span> A<span class="p">,</span> B<span class="p">)</span>
DT<span class="p">[</span><span class="m">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="m">6</span><span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B  C
## 1: b 6 NA
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Return the prevailing row</span>
DT<span class="p">[</span><span class="m">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> roll <span class="o">=</span> <span class="kc">TRUE</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B C
## 1: b 6 6
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Return the nearest row</span>
DT<span class="p">[</span><span class="m">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> roll <span class="o">=+</span> <span class="kc">Inf</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##    A B C
## 1: b 6 6
</pre></div>
</td></tr></table>

<p><strong>Rolling joins - part two</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Keyed data.table DT</span>
DT <span class="o">&lt;-</span> data.table<span class="p">(</span>A <span class="o">=</span> <span class="kc">letters</span><span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)],</span>                  B <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> 
                 C <span class="o">=</span> <span class="m">6</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> 
                 key <span class="o">=</span> <span class="s">&#39;A,B&#39;</span><span class="p">)</span>

<span class="c1"># Look at the sequence (-2):10 for the &#39;b&#39; group</span>
DT<span class="p">[</span><span class="m">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="o">:</span><span class="m">10</span><span class="p">)]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     A  B  C
##  1: b -2 NA
##  2: b -1 NA
##  3: b  0 NA
##  4: b  1  8
##  5: b  2 NA
##  6: b  3 NA
##  7: b  4 NA
##  8: b  5  6
##  9: b  6 NA
## 10: b  7 NA
## 11: b  8 11
## 12: b  9 NA
## 13: b 10 NA
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add code: carry the prevailing values forwards</span>
DT<span class="p">[</span><span class="m">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="o">:</span><span class="m">10</span><span class="p">),</span> roll <span class="o">=</span> <span class="kc">TRUE</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     A  B  C
##  1: b -2 NA
##  2: b -1 NA
##  3: b  0 NA
##  4: b  1  8
##  5: b  2  8
##  6: b  3  8
##  7: b  4  8
##  8: b  5  6
##  9: b  6  6
## 10: b  7  6
## 11: b  8 11
## 12: b  9 11
## 13: b 10 11
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add code: carry the first observation backwards</span>
DT<span class="p">[</span><span class="m">.</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="o">:</span><span class="m">10</span><span class="p">),</span> roll <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> rollends <span class="o">=</span> <span class="kc">TRUE</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##     A  B  C
##  1: b -2  8
##  2: b -1  8
##  3: b  0  8
##  4: b  1  8
##  5: b  2  8
##  6: b  3  8
##  7: b  4  8
##  8: b  5  6
##  9: b  6  6
## 10: b  7  6
## 11: b  8 11
## 12: b  9 11
## 13: b 10 11
</pre></div>
</td></tr></table>

<hr />
<h3 id="data-manipulation-in-r-with-dplyr">Data Manipulation in R with <code class="codehilite">dplyr</code><a class="headerlink" href="#data-manipulation-in-r-with-dplyr" title="Permanent link">&para;</a></h3>
<h4 id="1-introduction-to-dplyr">1, Introduction to <code class="codehilite">dplyr</code><a class="headerlink" href="#1-introduction-to-dplyr" title="Permanent link">&para;</a></h4>
<p><strong>Load the <code class="codehilite">dplyr</code> and <code class="codehilite">hflights</code> package</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Load the dplyr package</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dtplyr<span class="p">)</span>

<span class="c1"># Load the hflights package</span>
<span class="c1"># A data only package containing commercial domestic flights that departed Houston (IAH and HOU) in 2011</span>
<span class="kn">library</span><span class="p">(</span>hflights<span class="p">)</span>

<span class="c1"># Call both head() and summary() on hflights</span>
<span class="kp">head</span><span class="p">(</span>hflights<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##      Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
## 5424 2011     1          1         6    1400    1500            AA
## 5425 2011     1          2         7    1401    1501            AA
## 5426 2011     1          3         1    1352    1502            AA
## 5427 2011     1          4         2    1403    1513            AA
## 5428 2011     1          5         3    1405    1507            AA
## 5429 2011     1          6         4    1359    1503            AA
##      FlightNum TailNum ActualElapsedTime AirTime ArrDelay DepDelay Origin
## 5424       428  N576AA                60      40      -10        0    IAH
## 5425       428  N557AA                60      45       -9        1    IAH
## 5426       428  N541AA                70      48       -8       -8    IAH
## 5427       428  N403AA                70      39        3        3    IAH
## 5428       428  N492AA                62      44       -3        5    IAH
## 5429       428  N262AA                64      45       -7       -1    IAH
##      Dest Distance TaxiIn TaxiOut Cancelled CancellationCode Diverted
## 5424  DFW      224      7      13         0                         0
## 5425  DFW      224      6       9         0                         0
## 5426  DFW      224      5      17         0                         0
## 5427  DFW      224      9      22         0                         0
## 5428  DFW      224      9       9         0                         0
## 5429  DFW      224      6      13         0                         0
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kp">summary</span><span class="p">(</span>hflights<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">##       Year          Month          DayofMonth      DayOfWeek    </span>
<span class="c1">##  Min.   :2011   Min.   : 1.000   Min.   : 1.00   Min.   :1.000  </span>
<span class="c1">##  1st Qu.:2011   1st Qu.: 4.000   1st Qu.: 8.00   1st Qu.:2.000  </span>
<span class="c1">##  Median :2011   Median : 7.000   Median :16.00   Median :4.000  </span>
<span class="c1">##  Mean   :2011   Mean   : 6.514   Mean   :15.74   Mean   :3.948  </span>
<span class="c1">##  3rd Qu.:2011   3rd Qu.: 9.000   3rd Qu.:23.00   3rd Qu.:6.000  </span>
<span class="c1">##  Max.   :2011   Max.   :12.000   Max.   :31.00   Max.   :7.000  </span>
<span class="c1">##                                                                 </span>
<span class="c1">##     DepTime        ArrTime     UniqueCarrier        FlightNum   </span>
<span class="c1">##  Min.   :   1   Min.   :   1   Length:227496      Min.   :   1  </span>
<span class="c1">##  1st Qu.:1021   1st Qu.:1215   Class :character   1st Qu.: 855  </span>
<span class="c1">##  Median :1416   Median :1617   Mode  :character   Median :1696  </span>
<span class="c1">##  Mean   :1396   Mean   :1578                      Mean   :1962  </span>
<span class="c1">##  3rd Qu.:1801   3rd Qu.:1953                      3rd Qu.:2755  </span>
<span class="c1">##  Max.   :2400   Max.   :2400                      Max.   :7290  </span>
<span class="c1">##  NA&#39;s   :2905   NA&#39;s   :3066                                    </span>
<span class="c1">##    TailNum          ActualElapsedTime    AirTime         ArrDelay      </span>
<span class="c1">##  Length:227496      Min.   : 34.0     Min.   : 11.0   Min.   :-70.000  </span>
<span class="c1">##  Class :character   1st Qu.: 77.0     1st Qu.: 58.0   1st Qu.: -8.000  </span>
<span class="c1">##  Mode  :character   Median :128.0     Median :107.0   Median :  0.000  </span>
<span class="c1">##                     Mean   :129.3     Mean   :108.1   Mean   :  7.094  </span>
<span class="c1">##                     3rd Qu.:165.0     3rd Qu.:141.0   3rd Qu.: 11.000  </span>
<span class="c1">##                     Max.   :575.0     Max.   :549.0   Max.   :978.000  </span>
<span class="c1">##                     NA&#39;s   :3622      NA&#39;s   :3622    NA&#39;s   :3622     </span>
<span class="c1">##     DepDelay          Origin              Dest              Distance     </span>
<span class="c1">##  Min.   :-33.000   Length:227496      Length:227496      Min.   :  79.0  </span>
<span class="c1">##  1st Qu.: -3.000   Class :character   Class :character   1st Qu.: 376.0  </span>
<span class="c1">##  Median :  0.000   Mode  :character   Mode  :character   Median : 809.0  </span>
<span class="c1">##  Mean   :  9.445                                         Mean   : 787.8  </span>
<span class="c1">##  3rd Qu.:  9.000                                         3rd Qu.:1042.0  </span>
<span class="c1">##  Max.   :981.000                                         Max.   :3904.0  </span>
<span class="c1">##  NA&#39;s   :2905                                                            </span>
<span class="c1">##      TaxiIn           TaxiOut         Cancelled       CancellationCode  </span>
<span class="c1">##  Min.   :  1.000   Min.   :  1.00   Min.   :0.00000   Length:227496     </span>
<span class="c1">##  1st Qu.:  4.000   1st Qu.: 10.00   1st Qu.:0.00000   Class :character  </span>
<span class="c1">##  Median :  5.000   Median : 14.00   Median :0.00000   Mode  :character  </span>
<span class="c1">##  Mean   :  6.099   Mean   : 15.09   Mean   :0.01307                     </span>
<span class="c1">##  3rd Qu.:  7.000   3rd Qu.: 18.00   3rd Qu.:0.00000                     </span>
<span class="c1">##  Max.   :165.000   Max.   :163.00   Max.   :1.00000                     </span>
<span class="c1">##  NA&#39;s   :3066      NA&#39;s   :2947                                         </span>
<span class="c1">##     Diverted       </span>
<span class="c1">##  Min.   :0.000000  </span>
<span class="c1">##  1st Qu.:0.000000  </span>
<span class="c1">##  Median :0.000000  </span>
<span class="c1">##  Mean   :0.002853  </span>
<span class="c1">##  3rd Qu.:0.000000  </span>
<span class="c1">##  Max.   :1.000000  </span>
<span class="c1">##</span>
</pre></div>
</td></tr></table>

<p><strong>Convert <code class="codehilite">data.frame</code> to table</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Convert the hflights data.frame into a hflights tbl</span>
hflights <span class="o">&lt;-</span> tbl_df<span class="p">(</span>hflights<span class="p">)</span>

<span class="c1"># Display the hflights tbl</span>
hflights
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
## *  &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     1          1         6    1400    1500            AA
## 2   2011     1          2         7    1401    1501            AA
## 3   2011     1          3         1    1352    1502            AA
## 4   2011     1          4         2    1403    1513            AA
## 5   2011     1          5         3    1405    1507            AA
## 6   2011     1          6         4    1359    1503            AA
## 7   2011     1          7         5    1359    1509            AA
## 8   2011     1          8         6    1355    1454            AA
## 9   2011     1          9         7    1443    1554            AA
## 10  2011     1         10         1    1443    1553            AA
## # ... with 227,486 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Create the object carriers, containing only the UniqueCarrier variable of hflights</span>
carriers <span class="o">&lt;-</span> hflights<span class="o">$</span>UniqueCarrier
</pre></div>
</td></tr></table>

<p><strong>Changing labels of <code class="codehilite">hflights</code>, part 1 of 2</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># add</span>
lut <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;AA&#39;</span> <span class="o">=</span> <span class="s">&#39;American&#39;</span><span class="p">,</span> <span class="s">&#39;AS&#39;</span> <span class="o">=</span> <span class="s">&#39;Alaska&#39;</span><span class="p">,</span> <span class="s">&#39;B6&#39;</span> <span class="o">=</span> <span class="s">&#39;JetBlue&#39;</span><span class="p">,</span> <span class="s">&#39;CO&#39;</span> <span class="o">=</span> <span class="s">&#39;Continental&#39;</span><span class="p">,</span> 
         <span class="s">&#39;DL&#39;</span> <span class="o">=</span> <span class="s">&#39;Delta&#39;</span><span class="p">,</span> <span class="s">&#39;OO&#39;</span> <span class="o">=</span> <span class="s">&#39;SkyWest&#39;</span><span class="p">,</span> <span class="s">&#39;UA&#39;</span> <span class="o">=</span> <span class="s">&#39;United&#39;</span><span class="p">,</span> <span class="s">&#39;US&#39;</span> <span class="o">=</span> <span class="s">&#39;US_Airways&#39;</span><span class="p">,</span> 
         <span class="s">&#39;WN&#39;</span> <span class="o">=</span> <span class="s">&#39;Southwest&#39;</span><span class="p">,</span> <span class="s">&#39;EV&#39;</span> <span class="o">=</span> <span class="s">&#39;Atlantic_Southeast&#39;</span><span class="p">,</span> <span class="s">&#39;F9&#39;</span> <span class="o">=</span> <span class="s">&#39;Frontier&#39;</span><span class="p">,</span> 
         <span class="s">&#39;FL&#39;</span> <span class="o">=</span> <span class="s">&#39;AirTran&#39;</span><span class="p">,</span> <span class="s">&#39;MQ&#39;</span> <span class="o">=</span> <span class="s">&#39;American_Eagle&#39;</span><span class="p">,</span> <span class="s">&#39;XE&#39;</span> <span class="o">=</span> <span class="s">&#39;ExpressJet&#39;</span><span class="p">,</span> <span class="s">&#39;YV&#39;</span> <span class="o">=</span> <span class="s">&#39;Mesa&#39;</span><span class="p">)</span>

<span class="c1"># Use lut to translate the UniqueCarrier column of hflights</span>
hflights<span class="o">$</span>UniqueCarrier <span class="o">&lt;-</span> lut<span class="p">[</span>hflights<span class="o">$</span>UniqueCarrier<span class="p">]</span>

<span class="c1"># Inspect the resulting raw values of your variables</span>
glimpse<span class="p">(</span>hflights<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## Observations: 227,496
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ DayofMonth        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1...
## $ DayOfWeek         &lt;int&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6,...
## $ DepTime           &lt;int&gt; 1400, 1401, 1352, 1403, 1405, 1359, 1359, 13...
## $ ArrTime           &lt;int&gt; 1500, 1501, 1502, 1513, 1507, 1503, 1509, 14...
## $ UniqueCarrier     &lt;chr&gt; &quot;American&quot;, &quot;American&quot;, &quot;American&quot;, &quot;America...
## $ FlightNum         &lt;int&gt; 428, 428, 428, 428, 428, 428, 428, 428, 428,...
## $ TailNum           &lt;chr&gt; &quot;N576AA&quot;, &quot;N557AA&quot;, &quot;N541AA&quot;, &quot;N403AA&quot;, &quot;N49...
## $ ActualElapsedTime &lt;int&gt; 60, 60, 70, 70, 62, 64, 70, 59, 71, 70, 70, ...
## $ AirTime           &lt;int&gt; 40, 45, 48, 39, 44, 45, 43, 40, 41, 45, 42, ...
## $ ArrDelay          &lt;int&gt; -10, -9, -8, 3, -3, -7, -1, -16, 44, 43, 29,...
## $ DepDelay          &lt;int&gt; 0, 1, -8, 3, 5, -1, -1, -5, 43, 43, 29, 19, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;D...
## $ Distance          &lt;int&gt; 224, 224, 224, 224, 224, 224, 224, 224, 224,...
## $ TaxiIn            &lt;int&gt; 7, 6, 5, 9, 9, 6, 12, 7, 8, 6, 8, 4, 6, 5, 6...
## $ TaxiOut           &lt;int&gt; 13, 9, 17, 22, 9, 13, 15, 12, 22, 19, 20, 11...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
</pre></div>
</td></tr></table>

<p><strong>Changing labels of <code class="codehilite">hflights</code>, part 2 of 2</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Build the lookup table: lut</span>
lut <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="o">=</span> <span class="s">&quot;carrier&quot;</span><span class="p">,</span> <span class="s">&quot;B&quot;</span> <span class="o">=</span> <span class="s">&quot;weather&quot;</span> <span class="p">,</span><span class="s">&quot;C&quot;</span> <span class="o">=</span> <span class="s">&quot;FFA&quot;</span> <span class="p">,</span><span class="s">&quot;D&quot;</span> <span class="o">=</span> <span class="s">&quot;security&quot;</span><span class="p">,</span> <span class="s">&quot;E&quot;</span> <span class="o">=</span> <span class="s">&quot;not cancelled&quot;</span><span class="p">)</span>

<span class="c1"># Add the Code column</span>
hflights<span class="o">$</span>Code <span class="o">&lt;-</span> lut<span class="p">[</span>hflights<span class="o">$</span>CancellationCode<span class="p">]</span>

<span class="c1"># Glimpse at hflights</span>
glimpse<span class="p">(</span>hflights<span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Result.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Observations: 227,496
Variables: 22
$ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011,...
$ Month             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
$ DayofMonth        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, ...
$ DayOfWeek         &lt;int&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3,...
$ DepTime           &lt;int&gt; 1400, 1401, 1352, 1403, 1405, 1359,...
$ ArrTime           &lt;int&gt; 1500, 1501, 1502, 1513, 1507, 1503,...
$ UniqueCarrier     &lt;chr&gt; &quot;American&quot;, &quot;American&quot;, &quot;American&quot;,...
$ FlightNum         &lt;int&gt; 428, 428, 428, 428, 428, 428, 428, ...
$ TailNum           &lt;chr&gt; &quot;N576AA&quot;, &quot;N557AA&quot;, &quot;N541AA&quot;, &quot;N403...
$ ActualElapsedTime &lt;int&gt; 60, 60, 70, 70, 62, 64, 70, 59, 71,...
$ AirTime           &lt;int&gt; 40, 45, 48, 39, 44, 45, 43, 40, 41,...
$ ArrDelay          &lt;int&gt; -10, -9, -8, 3, -3, -7, -1, -16, 44...
$ DepDelay          &lt;int&gt; 0, 1, -8, 3, 5, -1, -1, -5, 43, 43,...
$ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, ...
$ Dest              &lt;chr&gt; &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, ...
$ Distance          &lt;int&gt; 224, 224, 224, 224, 224, 224, 224, ...
$ TaxiIn            &lt;int&gt; 7, 6, 5, 9, 9, 6, 12, 7, 8, 6, 8, 4...
$ TaxiOut           &lt;int&gt; 13, 9, 17, 22, 9, 13, 15, 12, 22, 1...
$ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
$ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;,...
$ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
$ Code              &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA,...
</pre></div>
</td></tr></table>

<h4 id="2-select-and-mutate">2, <code class="codehilite">select</code> and <code class="codehilite">mutate</code><a class="headerlink" href="#2-select-and-mutate" title="Permanent link">&para;</a></h4>
<p><strong>The five verbs and their meaning</strong></p>
<ul>
<li><code class="codehilite">select</code>; which returns a subset of the columns.</li>
<li><code class="codehilite">filter</code>; that is able to return a subset of the rows.</li>
<li><code class="codehilite">arrange</code>; that reorders the rows according to single or<br />
    multiple variables.</li>
<li><code class="codehilite">mutate</code>; used to add columns from existing data.</li>
<li><code class="codehilite">summarise</code>; which reduces each group to a single row by calculating<br />
    aggregate measures.</li>
</ul>
<p><strong>Choosing is not losing! The <code class="codehilite">select</code> verb</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print out a tbl with the four columns of hflights related to delay</span>
select<span class="p">(</span>hflights<span class="p">,</span> ActualElapsedTime<span class="p">,</span> AirTime<span class="p">,</span> ArrDelay<span class="p">,</span> DepDelay<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 4
##    ActualElapsedTime AirTime ArrDelay DepDelay
## *              &lt;int&gt;   &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
## 1                 60      40      -10        0
## 2                 60      45       -9        1
## 3                 70      48       -8       -8
## 4                 70      39        3        3
## 5                 62      44       -3        5
## 6                 64      45       -7       -1
## 7                 70      43       -1       -1
## 8                 59      40      -16       -5
## 9                 71      41       44       43
## 10                70      45       43       43
## # ... with 227,486 more rows
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print out hflights, nothing has changed!</span>
hflights
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
## *  &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     1          1         6    1400    1500      American
## 2   2011     1          2         7    1401    1501      American
## 3   2011     1          3         1    1352    1502      American
## 4   2011     1          4         2    1403    1513      American
## 5   2011     1          5         3    1405    1507      American
## 6   2011     1          6         4    1359    1503      American
## 7   2011     1          7         5    1359    1509      American
## 8   2011     1          8         6    1355    1454      American
## 9   2011     1          9         7    1443    1554      American
## 10  2011     1         10         1    1443    1553      American
## # ... with 227,486 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print out the columns Origin up to Cancelled of hflights</span>
select<span class="p">(</span>hflights<span class="p">,</span> <span class="m">14</span><span class="o">:</span><span class="m">19</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 6
##    Origin  Dest Distance TaxiIn TaxiOut Cancelled
## *   &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;  &lt;int&gt;   &lt;int&gt;     &lt;int&gt;
## 1     IAH   DFW      224      7      13         0
## 2     IAH   DFW      224      6       9         0
## 3     IAH   DFW      224      5      17         0
## 4     IAH   DFW      224      9      22         0
## 5     IAH   DFW      224      9       9         0
## 6     IAH   DFW      224      6      13         0
## 7     IAH   DFW      224     12      15         0
## 8     IAH   DFW      224      7      12         0
## 9     IAH   DFW      224      8      22         0
## 10    IAH   DFW      224      6      19         0
## # ... with 227,486 more rows
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Answer to last question: be concise!</span>
select<span class="p">(</span>hflights<span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="m">12</span><span class="o">:</span><span class="m">21</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 14
##     Year Month DayofMonth DayOfWeek ArrDelay DepDelay Origin  Dest
## *  &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;    &lt;int&gt;    &lt;int&gt;  &lt;chr&gt; &lt;chr&gt;
## 1   2011     1          1         6      -10        0    IAH   DFW
## 2   2011     1          2         7       -9        1    IAH   DFW
## 3   2011     1          3         1       -8       -8    IAH   DFW
## 4   2011     1          4         2        3        3    IAH   DFW
## 5   2011     1          5         3       -3        5    IAH   DFW
## 6   2011     1          6         4       -7       -1    IAH   DFW
## 7   2011     1          7         5       -1       -1    IAH   DFW
## 8   2011     1          8         6      -16       -5    IAH   DFW
## 9   2011     1          9         7       44       43    IAH   DFW
## 10  2011     1         10         1       43       43    IAH   DFW
## # ... with 227,486 more rows, and 6 more variables: Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<p><strong>Helper functions for variable selection</strong></p>
<p><code class="codehilite">select</code>:</p>
<ul>
<li><code class="codehilite">starts_with(&quot;X&quot;)</code>; every name that starts with <code class="codehilite">&quot;X&quot;</code>,</li>
<li><code class="codehilite">ends_with(&quot;X&quot;)</code>; every name that ends with <code class="codehilite">&quot;X&quot;</code>,</li>
<li><code class="codehilite">contains(&quot;X&quot;)</code>; every name that contains <code class="codehilite">&quot;X&quot;</code>,</li>
<li><code class="codehilite">matches(&quot;X&quot;)</code>; every name that matches <code class="codehilite">&quot;X&quot;</code>, where <code class="codehilite">&quot;X&quot;</code> can be a<br />
    regular expression,</li>
<li><code class="codehilite">num_range(&quot;x&quot;, 1:5)</code>; the variables named <code class="codehilite">x01</code>, <code class="codehilite">x02</code>, <code class="codehilite">x03</code>, -<br />
<code class="codehilite">x04</code> and <code class="codehilite">x05</code>,</li>
<li><code class="codehilite">one_of(x)</code>; every name that appears in <code class="codehilite">x</code>, which should be a<br />
    character vector.</li>
</ul>
<!-- -->

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print out a tbl containing just ArrDelay and DepDelay</span>
select<span class="p">(</span>hflights<span class="p">,</span> ArrDelay<span class="p">,</span> DepDelay<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 2
##    ArrDelay DepDelay
## *     &lt;int&gt;    &lt;int&gt;
## 1       -10        0
## 2        -9        1
## 3        -8       -8
## 4         3        3
## 5        -3        5
## 6        -7       -1
## 7        -1       -1
## 8       -16       -5
## 9        44       43
## 10       43       43
## # ... with 227,486 more rows
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print out a tbl as described in the second instruction, using both helper functions and variable names</span>
select<span class="p">(</span>hflights<span class="p">,</span> UniqueCarrier<span class="p">,</span> ends_with<span class="p">(</span><span class="s">&#39;Num&#39;</span><span class="p">),</span> starts_with<span class="p">(</span><span class="s">&#39;Cancel&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 5
##    UniqueCarrier FlightNum TailNum Cancelled CancellationCode
## *          &lt;chr&gt;     &lt;int&gt;   &lt;chr&gt;     &lt;int&gt;            &lt;chr&gt;
## 1       American       428  N576AA         0                 
## 2       American       428  N557AA         0                 
## 3       American       428  N541AA         0                 
## 4       American       428  N403AA         0                 
## 5       American       428  N492AA         0                 
## 6       American       428  N262AA         0                 
## 7       American       428  N493AA         0                 
## 8       American       428  N477AA         0                 
## 9       American       428  N476AA         0                 
## 10      American       428  N504AA         0                 
## # ... with 227,486 more rows
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print out a tbl as described in the third instruction, using only helper functions.</span>
select<span class="p">(</span>hflights<span class="p">,</span> ends_with<span class="p">(</span><span class="s">&#39;Time&#39;</span><span class="p">),</span> ends_with<span class="p">(</span><span class="s">&#39;Delay&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 6
##    DepTime ArrTime ActualElapsedTime AirTime ArrDelay DepDelay
## *    &lt;int&gt;   &lt;int&gt;             &lt;int&gt;   &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
## 1     1400    1500                60      40      -10        0
## 2     1401    1501                60      45       -9        1
## 3     1352    1502                70      48       -8       -8
## 4     1403    1513                70      39        3        3
## 5     1405    1507                62      44       -3        5
## 6     1359    1503                64      45       -7       -1
## 7     1359    1509                70      43       -1       -1
## 8     1355    1454                59      40      -16       -5
## 9     1443    1554                71      41       44       43
## 10    1443    1553                70      45       43       43
## # ... with 227,486 more rows
</pre></div>
</td></tr></table>

<p><strong>Comparison to basic R</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># add</span>
ex1r <span class="o">&lt;-</span> hflights<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;TaxiIn&#39;</span><span class="p">,</span><span class="s">&#39;TaxiOut&#39;</span><span class="p">,</span><span class="s">&#39;Distance&#39;</span><span class="p">)]</span>

ex1d <span class="o">&lt;-</span> select<span class="p">(</span>hflights<span class="p">,</span> starts_with<span class="p">(</span><span class="s">&#39;Taxi&#39;</span><span class="p">),</span> Distance<span class="p">)</span>

ex2r <span class="o">&lt;-</span> hflights<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;Year&#39;</span><span class="p">,</span><span class="s">&#39;Month&#39;</span><span class="p">,</span><span class="s">&#39;DayOfWeek&#39;</span><span class="p">,</span><span class="s">&#39;DepTime&#39;</span><span class="p">,</span><span class="s">&#39;ArrTime&#39;</span><span class="p">)]</span>

ex2d <span class="o">&lt;-</span> select<span class="p">(</span>hflights<span class="p">,</span> Year<span class="p">,</span> Month<span class="p">,</span> DayOfWeek<span class="p">,</span> DepTime<span class="p">,</span> ArrTime<span class="p">)</span>

ex3r <span class="o">&lt;-</span> hflights<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;TailNum&#39;</span><span class="p">,</span><span class="s">&#39;TaxiIn&#39;</span><span class="p">,</span><span class="s">&#39;TaxiOut&#39;</span><span class="p">)]</span>

ex3d <span class="o">&lt;-</span> select<span class="p">(</span>hflights<span class="p">,</span> TailNum<span class="p">,</span> starts_with<span class="p">(</span><span class="s">&#39;Taxi&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p><strong>Mutating is creating</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add the new variable ActualGroundTime to a copy of hflights and save the result as g1</span>
g1 <span class="o">&lt;-</span> mutate<span class="p">(</span>hflights<span class="p">,</span> ActualGroundTime <span class="o">=</span> ActualElapsedTime <span class="o">-</span> AirTime<span class="p">)</span>
glimpse<span class="p">(</span>hflights<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## Observations: 227,496
## Variables: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ DayofMonth        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1...
## $ DayOfWeek         &lt;int&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6,...
## $ DepTime           &lt;int&gt; 1400, 1401, 1352, 1403, 1405, 1359, 1359, 13...
## $ ArrTime           &lt;int&gt; 1500, 1501, 1502, 1513, 1507, 1503, 1509, 14...
## $ UniqueCarrier     &lt;chr&gt; &quot;American&quot;, &quot;American&quot;, &quot;American&quot;, &quot;America...
## $ FlightNum         &lt;int&gt; 428, 428, 428, 428, 428, 428, 428, 428, 428,...
## $ TailNum           &lt;chr&gt; &quot;N576AA&quot;, &quot;N557AA&quot;, &quot;N541AA&quot;, &quot;N403AA&quot;, &quot;N49...
## $ ActualElapsedTime &lt;int&gt; 60, 60, 70, 70, 62, 64, 70, 59, 71, 70, 70, ...
## $ AirTime           &lt;int&gt; 40, 45, 48, 39, 44, 45, 43, 40, 41, 45, 42, ...
## $ ArrDelay          &lt;int&gt; -10, -9, -8, 3, -3, -7, -1, -16, 44, 43, 29,...
## $ DepDelay          &lt;int&gt; 0, 1, -8, 3, 5, -1, -1, -5, 43, 43, 29, 19, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;D...
## $ Distance          &lt;int&gt; 224, 224, 224, 224, 224, 224, 224, 224, 224,...
## $ TaxiIn            &lt;int&gt; 7, 6, 5, 9, 9, 6, 12, 7, 8, 6, 8, 4, 6, 5, 6...
## $ TaxiOut           &lt;int&gt; 13, 9, 17, 22, 9, 13, 15, 12, 22, 19, 20, 11...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>glimpse<span class="p">(</span>g1<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## Observations: 227,496
## Variables: 22
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ DayofMonth        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1...
## $ DayOfWeek         &lt;int&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6,...
## $ DepTime           &lt;int&gt; 1400, 1401, 1352, 1403, 1405, 1359, 1359, 13...
## $ ArrTime           &lt;int&gt; 1500, 1501, 1502, 1513, 1507, 1503, 1509, 14...
## $ UniqueCarrier     &lt;chr&gt; &quot;American&quot;, &quot;American&quot;, &quot;American&quot;, &quot;America...
## $ FlightNum         &lt;int&gt; 428, 428, 428, 428, 428, 428, 428, 428, 428,...
## $ TailNum           &lt;chr&gt; &quot;N576AA&quot;, &quot;N557AA&quot;, &quot;N541AA&quot;, &quot;N403AA&quot;, &quot;N49...
## $ ActualElapsedTime &lt;int&gt; 60, 60, 70, 70, 62, 64, 70, 59, 71, 70, 70, ...
## $ AirTime           &lt;int&gt; 40, 45, 48, 39, 44, 45, 43, 40, 41, 45, 42, ...
## $ ArrDelay          &lt;int&gt; -10, -9, -8, 3, -3, -7, -1, -16, 44, 43, 29,...
## $ DepDelay          &lt;int&gt; 0, 1, -8, 3, 5, -1, -1, -5, 43, 43, 29, 19, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;D...
## $ Distance          &lt;int&gt; 224, 224, 224, 224, 224, 224, 224, 224, 224,...
## $ TaxiIn            &lt;int&gt; 7, 6, 5, 9, 9, 6, 12, 7, 8, 6, 8, 4, 6, 5, 6...
## $ TaxiOut           &lt;int&gt; 13, 9, 17, 22, 9, 13, 15, 12, 22, 19, 20, 11...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ ActualGroundTime  &lt;int&gt; 20, 15, 22, 31, 18, 19, 27, 19, 30, 25, 28, ...
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add the new variable GroundTime to a g1; save the result as g2</span>
g2 <span class="o">&lt;-</span> mutate<span class="p">(</span>g1<span class="p">,</span> GroundTime <span class="o">=</span> TaxiIn <span class="o">+</span> TaxiOut<span class="p">)</span>

<span class="kp">head</span><span class="p">(</span>g1<span class="o">$</span>ActualGroundTime <span class="o">==</span> g2<span class="o">$</span>GroundTime<span class="p">,</span> <span class="m">20</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>##  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [15] TRUE TRUE TRUE TRUE TRUE TRUE
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add the new variable AverageSpeed to g2; save the result as g3</span>
g3 <span class="o">&lt;-</span> mutate<span class="p">(</span>g2<span class="p">,</span> AverageSpeed <span class="o">=</span> Distance <span class="o">/</span> AirTime <span class="o">*</span> <span class="m">60</span><span class="p">)</span>
g3
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 24
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     1          1         6    1400    1500      American
## 2   2011     1          2         7    1401    1501      American
## 3   2011     1          3         1    1352    1502      American
## 4   2011     1          4         2    1403    1513      American
## 5   2011     1          5         3    1405    1507      American
## 6   2011     1          6         4    1359    1503      American
## 7   2011     1          7         5    1359    1509      American
## 8   2011     1          8         6    1355    1454      American
## 9   2011     1          9         7    1443    1554      American
## 10  2011     1         10         1    1443    1553      American
## # ... with 227,486 more rows, and 17 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;, ActualGroundTime &lt;int&gt;, GroundTime &lt;int&gt;,
## #   AverageSpeed &lt;dbl&gt;
</pre></div>
</td></tr></table>

<p><strong>Add multiple variables using mutate</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Add a second variable loss_percent to the dataset: m1</span>
m1 <span class="o">&lt;-</span> mutate<span class="p">(</span>hflights<span class="p">,</span> loss <span class="o">=</span> ArrDelay <span class="o">-</span> DepDelay<span class="p">,</span> loss_percent <span class="o">=</span> <span class="p">(</span>ArrDelay <span class="o">-</span> DepDelay<span class="p">)</span><span class="o">/</span>DepDelay<span class="o">*</span><span class="m">100</span><span class="p">)</span>

<span class="c1"># Copy and adapt the previous command to reduce redendancy: m2</span>
m2 <span class="o">&lt;-</span> mutate<span class="p">(</span>hflights<span class="p">,</span> loss <span class="o">=</span> ArrDelay <span class="o">-</span> DepDelay<span class="p">,</span> loss_percent <span class="o">=</span> loss<span class="o">/</span>DepDelay <span class="o">*</span> <span class="m">100</span><span class="p">)</span>

<span class="c1"># Add the three variables as described in the third instruction: m3</span>
m3 <span class="o">&lt;-</span> mutate<span class="p">(</span>hflights<span class="p">,</span> TotalTaxi <span class="o">=</span> TaxiIn <span class="o">+</span> TaxiOut<span class="p">,</span> ActualGroundTime <span class="o">=</span> ActualElapsedTime <span class="o">-</span> AirTime<span class="p">,</span> Diff <span class="o">=</span> TotalTaxi <span class="o">-</span> ActualGroundTime<span class="p">)</span>
glimpse<span class="p">(</span>m3<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## Observations: 227,496
## Variables: 24
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 20...
## $ Month             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ DayofMonth        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1...
## $ DayOfWeek         &lt;int&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6,...
## $ DepTime           &lt;int&gt; 1400, 1401, 1352, 1403, 1405, 1359, 1359, 13...
## $ ArrTime           &lt;int&gt; 1500, 1501, 1502, 1513, 1507, 1503, 1509, 14...
## $ UniqueCarrier     &lt;chr&gt; &quot;American&quot;, &quot;American&quot;, &quot;American&quot;, &quot;America...
## $ FlightNum         &lt;int&gt; 428, 428, 428, 428, 428, 428, 428, 428, 428,...
## $ TailNum           &lt;chr&gt; &quot;N576AA&quot;, &quot;N557AA&quot;, &quot;N541AA&quot;, &quot;N403AA&quot;, &quot;N49...
## $ ActualElapsedTime &lt;int&gt; 60, 60, 70, 70, 62, 64, 70, 59, 71, 70, 70, ...
## $ AirTime           &lt;int&gt; 40, 45, 48, 39, 44, 45, 43, 40, 41, 45, 42, ...
## $ ArrDelay          &lt;int&gt; -10, -9, -8, 3, -3, -7, -1, -16, 44, 43, 29,...
## $ DepDelay          &lt;int&gt; 0, 1, -8, 3, 5, -1, -1, -5, 43, 43, 29, 19, ...
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;I...
## $ Dest              &lt;chr&gt; &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;D...
## $ Distance          &lt;int&gt; 224, 224, 224, 224, 224, 224, 224, 224, 224,...
## $ TaxiIn            &lt;int&gt; 7, 6, 5, 9, 9, 6, 12, 7, 8, 6, 8, 4, 6, 5, 6...
## $ TaxiOut           &lt;int&gt; 13, 9, 17, 22, 9, 13, 15, 12, 22, 19, 20, 11...
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, ...
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ TotalTaxi         &lt;int&gt; 20, 15, 22, 31, 18, 19, 27, 19, 30, 25, 28, ...
## $ ActualGroundTime  &lt;int&gt; 20, 15, 22, 31, 18, 19, 27, 19, 30, 25, 28, ...
## $ Diff              &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
</pre></div>
</td></tr></table>

<h4 id="3-filter-and-arrange">3, <code class="codehilite">filter</code> and <code class="codehilite">arrange</code><a class="headerlink" href="#3-filter-and-arrange" title="Permanent link">&para;</a></h4>
<p><strong>Logical operators</strong></p>
<p><code class="codehilite">filter</code>:</p>
<ul>
<li><code class="codehilite">x &lt; y</code>; <code class="codehilite">TRUE</code> if <code class="codehilite">x</code> is less than <code class="codehilite">y</code>.</li>
<li><code class="codehilite">x &lt;= y</code>; <code class="codehilite">TRUE</code> if <code class="codehilite">x</code> is less than or equal to <code class="codehilite">y</code>.</li>
<li><code class="codehilite">x == y</code>; <code class="codehilite">TRUE</code> if <code class="codehilite">x</code> equals <code class="codehilite">y</code>.</li>
<li><code class="codehilite">x != y</code>; <code class="codehilite">TRUE</code> if <code class="codehilite">x</code> does not equal <code class="codehilite">y</code>.</li>
<li><code class="codehilite">x &gt;= y</code>; <code class="codehilite">TRUE</code> if <code class="codehilite">x</code> is greater than or equal to <code class="codehilite">y</code>.</li>
<li><code class="codehilite">x &gt; y</code>; <code class="codehilite">TRUE</code> if <code class="codehilite">x</code> is greater than <code class="codehilite">y</code>.</li>
<li><code class="codehilite">x %in% c(a, b, c)</code>; <code class="codehilite">TRUE</code> if <code class="codehilite">x</code> is in the vector <code class="codehilite">c(a, b, c)</code>.</li>
</ul>
<!-- -->

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># All flights that traveled 3000 miles or more</span>
filter<span class="p">(</span>hflights<span class="p">,</span> Distance <span class="o">&gt;=</span> <span class="m">3000</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 527 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     1         31         1     924    1413   Continental
## 2   2011     1         30         7     925    1410   Continental
## 3   2011     1         29         6    1045    1445   Continental
## 4   2011     1         28         5    1516    1916   Continental
## 5   2011     1         27         4     950    1344   Continental
## 6   2011     1         26         3     944    1350   Continental
## 7   2011     1         25         2     924    1337   Continental
## 8   2011     1         24         1    1144    1605   Continental
## 9   2011     1         23         7     926    1335   Continental
## 10  2011     1         22         6     942    1340   Continental
## # ... with 517 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># All flights flown by one of JetBlue, Southwest, or Delta</span>
filter<span class="p">(</span>hflights<span class="p">,</span> UniqueCarrier <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;JetBlue&#39;</span><span class="p">,</span><span class="s">&#39;Southwest&#39;</span><span class="p">,</span><span class="s">&#39;Delta&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 48,679 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     1          1         6     654    1124       JetBlue
## 2   2011     1          1         6    1639    2110       JetBlue
## 3   2011     1          2         7     703    1113       JetBlue
## 4   2011     1          2         7    1604    2040       JetBlue
## 5   2011     1          3         1     659    1100       JetBlue
## 6   2011     1          3         1    1801    2200       JetBlue
## 7   2011     1          4         2     654    1103       JetBlue
## 8   2011     1          4         2    1608    2034       JetBlue
## 9   2011     1          5         3     700    1103       JetBlue
## 10  2011     1          5         3    1544    1954       JetBlue
## # ... with 48,669 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># All flights where taxiing took longer than flying</span>
filter<span class="p">(</span>hflights<span class="p">,</span> <span class="p">(</span>TaxiIn <span class="o">+</span> TaxiOut<span class="p">)</span> <span class="o">&gt;</span> AirTime<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1,389 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     1         24         1     731     904      American
## 2   2011     1         30         7    1959    2132      American
## 3   2011     1         24         1    1621    1749      American
## 4   2011     1         10         1     941    1113      American
## 5   2011     1         31         1    1301    1356   Continental
## 6   2011     1         31         1    2113    2215   Continental
## 7   2011     1         31         1    1434    1539   Continental
## 8   2011     1         31         1     900    1006   Continental
## 9   2011     1         30         7    1304    1408   Continental
## 10  2011     1         30         7    2004    2128   Continental
## # ... with 1,379 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<p><strong>Combining tests using boolean operators</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># All flights that departed before 5am or arrived after 10pm</span>
filter<span class="p">(</span>hflights<span class="p">,</span> DepTime <span class="o">&lt;</span> <span class="m">500</span> <span class="o">|</span> ArrTime <span class="o">&gt;</span> <span class="m">2200</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 27,799 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     1          4         2    2100    2207      American
## 2   2011     1         14         5    2119    2229      American
## 3   2011     1         10         1    1934    2235      American
## 4   2011     1         26         3    1905    2211      American
## 5   2011     1         30         7    1856    2209      American
## 6   2011     1          9         7    1938    2228        Alaska
## 7   2011     1         31         1    1919    2231   Continental
## 8   2011     1         31         1    2116    2344   Continental
## 9   2011     1         31         1    1850    2211   Continental
## 10  2011     1         31         1    2102    2216   Continental
## # ... with 27,789 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># All flights that departed late but arrived ahead of schedule</span>
filter<span class="p">(</span>hflights<span class="p">,</span> DepDelay <span class="o">&gt;</span> <span class="m">0</span> <span class="o">&amp;</span> ArrDelay <span class="o">&lt;</span> <span class="m">0</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 27,712 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     1          2         7    1401    1501      American
## 2   2011     1          5         3    1405    1507      American
## 3   2011     1         18         2    1408    1508      American
## 4   2011     1         18         2     721     827      American
## 5   2011     1         12         3    2015    2113      American
## 6   2011     1         13         4    2020    2116      American
## 7   2011     1         26         3    2009    2103      American
## 8   2011     1          1         6    1631    1736      American
## 9   2011     1         10         1    1639    1740      American
## 10  2011     1         12         3    1631    1739      American
## # ... with 27,702 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># All cancelled weekend flights</span>
filter<span class="p">(</span>hflights<span class="p">,</span> DayOfWeek <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">)</span> <span class="o">&amp;</span> Cancelled <span class="o">==</span> <span class="m">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 585 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime      UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;              &lt;chr&gt;
## 1   2011     1          9         7      NA      NA           American
## 2   2011     1         29         6      NA      NA        Continental
## 3   2011     1          9         7      NA      NA        Continental
## 4   2011     1          9         7      NA      NA              Delta
## 5   2011     1          9         7      NA      NA            SkyWest
## 6   2011     1          2         7      NA      NA          Southwest
## 7   2011     1         29         6      NA      NA              Delta
## 8   2011     1          9         7      NA      NA Atlantic_Southeast
## 9   2011     1          1         6      NA      NA            AirTran
## 10  2011     1          9         7      NA      NA            AirTran
## # ... with 575 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># All flights that were cancelled after being delayed</span>
filter<span class="p">(</span>hflights<span class="p">,</span> DepDelay <span class="o">&gt;</span> <span class="m">0</span> <span class="o">&amp;</span> Cancelled <span class="o">==</span> <span class="m">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 40 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     1         26         3    1926      NA   Continental
## 2   2011     1         11         2    1100      NA    US_Airways
## 3   2011     1         19         3    1811      NA    ExpressJet
## 4   2011     1          7         5    2028      NA    ExpressJet
## 5   2011     2          4         5    1638      NA      American
## 6   2011     2          8         2    1057      NA   Continental
## 7   2011     2          2         3     802      NA    ExpressJet
## 8   2011     2          9         3     904      NA    ExpressJet
## 9   2011     2          1         2    1508      NA       SkyWest
## 10  2011     3         31         4    1016      NA   Continental
## # ... with 30 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<p><strong>Blend together what you&rsquo;ve learned!</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Select the flights that had JFK as their destination: c1</span>
c1 <span class="o">&lt;-</span> filter<span class="p">(</span>hflights<span class="p">,</span> Dest <span class="o">==</span> <span class="s">&#39;JFK&#39;</span><span class="p">)</span>

<span class="c1"># Combine the Year, Month and DayofMonth variables to create a Date column: c2</span>
c2 <span class="o">&lt;-</span> mutate<span class="p">(</span>c1<span class="p">,</span> Date <span class="o">=</span> <span class="kp">paste</span><span class="p">(</span>Year<span class="p">,</span> Month<span class="p">,</span> DayofMonth<span class="p">,</span> sep <span class="o">=</span> <span class="s">&#39;-&#39;</span><span class="p">))</span>

<span class="c1"># Print out a selection of columns of c2</span>
select<span class="p">(</span>c2<span class="p">,</span> Date<span class="p">,</span> DepTime<span class="p">,</span> ArrTime<span class="p">,</span> TailNum<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 695 × 4
##        Date DepTime ArrTime TailNum
##       &lt;chr&gt;   &lt;int&gt;   &lt;int&gt;   &lt;chr&gt;
## 1  2011-1-1     654    1124  N324JB
## 2  2011-1-1    1639    2110  N324JB
## 3  2011-1-2     703    1113  N324JB
## 4  2011-1-2    1604    2040  N324JB
## 5  2011-1-3     659    1100  N229JB
## 6  2011-1-3    1801    2200  N206JB
## 7  2011-1-4     654    1103  N267JB
## 8  2011-1-4    1608    2034  N267JB
## 9  2011-1-5     700    1103  N708JB
## 10 2011-1-5    1544    1954  N644JB
## # ... with 685 more rows
</pre></div>
</td></tr></table>

<p><strong>Arranging your data</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Definition of dtc</span>
dtc <span class="o">&lt;-</span> filter<span class="p">(</span>hflights<span class="p">,</span> Cancelled <span class="o">==</span> <span class="m">1</span><span class="p">,</span> <span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>DepDelay<span class="p">))</span>

<span class="c1"># Arrange dtc by departure delays</span>
arrange<span class="p">(</span>dtc<span class="p">,</span> DepDelay<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 68 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime  UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;          &lt;chr&gt;
## 1   2011     7         23         6     605      NA       Frontier
## 2   2011     1         17         1     916      NA     ExpressJet
## 3   2011    12          1         4     541      NA     US_Airways
## 4   2011    10         12         3    2022      NA American_Eagle
## 5   2011     7         29         5    1424      NA    Continental
## 6   2011     9         29         4    1639      NA        SkyWest
## 7   2011     2          9         3     555      NA American_Eagle
## 8   2011     5          9         1     715      NA        SkyWest
## 9   2011     1         20         4    1413      NA         United
## 10  2011     1         17         1     831      NA      Southwest
## # ... with 58 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Arrange dtc so that cancellation reasons are grouped</span>
arrange<span class="p">(</span>dtc<span class="p">,</span> CancellationCode<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 68 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime  UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;          &lt;chr&gt;
## 1   2011     1         20         4    1413      NA         United
## 2   2011     1          7         5    2028      NA     ExpressJet
## 3   2011     2          4         5    1638      NA       American
## 4   2011     2          8         2    1057      NA    Continental
## 5   2011     2          1         2    1508      NA        SkyWest
## 6   2011     2         21         1    2257      NA        SkyWest
## 7   2011     2          9         3     555      NA American_Eagle
## 8   2011     3         18         5     727      NA         United
## 9   2011     4          4         1    1632      NA          Delta
## 10  2011     4          8         5    1608      NA      Southwest
## # ... with 58 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Arrange dtc according to carrier and departure delays</span>
arrange<span class="p">(</span>dtc<span class="p">,</span> UniqueCarrier<span class="p">,</span> DepDelay<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 68 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime      UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;              &lt;chr&gt;
## 1   2011     6         11         6    1649      NA            AirTran
## 2   2011     8         18         4    1808      NA           American
## 3   2011     2          4         5    1638      NA           American
## 4   2011    10         12         3    2022      NA     American_Eagle
## 5   2011     2          9         3     555      NA     American_Eagle
## 6   2011     7         17         7    1917      NA     American_Eagle
## 7   2011     4         30         6     612      NA Atlantic_Southeast
## 8   2011     4         10         7    1147      NA Atlantic_Southeast
## 9   2011     5         23         1     657      NA Atlantic_Southeast
## 10  2011     9         29         4     723      NA Atlantic_Southeast
## # ... with 58 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<p><strong>Reverse the order of arranging</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Arrange according to carrier and decreasing departure delays</span>
arrange<span class="p">(</span>hflights<span class="p">,</span> UniqueCarrier<span class="p">,</span> desc<span class="p">(</span>DepDelay<span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     2         19         6    1902    2143       AirTran
## 2   2011     3         14         1    2024    2309       AirTran
## 3   2011     2         16         3    2349     227       AirTran
## 4   2011    11         13         7    2312     213       AirTran
## 5   2011     5         26         4    2353     305       AirTran
## 6   2011     5         26         4    1922    2229       AirTran
## 7   2011     4         28         4    1045    1328       AirTran
## 8   2011     6          5         7    2207      52       AirTran
## 9   2011     5          7         6    1009    1256       AirTran
## 10  2011     7         25         1    2107      14       AirTran
## # ... with 227,486 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Arrange flights by total delay (normal order).</span>
arrange<span class="p">(</span>hflights<span class="p">,</span> <span class="p">(</span>ArrDelay<span class="o">+</span>DepDelay<span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 227,496 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;         &lt;chr&gt;
## 1   2011     7          3         7    1914    2039    ExpressJet
## 2   2011     8         31         3     934    1039       SkyWest
## 3   2011     8         21         7     935    1039       SkyWest
## 4   2011     8         28         7    2059    2206       SkyWest
## 5   2011     8         29         1     935    1041       SkyWest
## 6   2011    12         25         7     741     926       SkyWest
## 7   2011     1         30         7     620     812       SkyWest
## 8   2011     8          3         3    1741    1810    ExpressJet
## 9   2011     8          4         4     930    1041       SkyWest
## 10  2011     8         18         4     939    1043       SkyWest
## # ... with 227,486 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Keep flights leaving to DFW before 8am and arrange according to decreasing AirTime </span>
arrange<span class="p">(</span>filter<span class="p">(</span>hflights<span class="p">,</span> Dest <span class="o">==</span> <span class="s">&#39;DFW&#39;</span> <span class="o">&amp;</span> DepTime<span class="o">&lt;</span><span class="m">800</span><span class="p">),</span> desc<span class="p">(</span>AirTime<span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 799 × 21
##     Year Month DayofMonth DayOfWeek DepTime ArrTime  UniqueCarrier
##    &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;          &lt;chr&gt;
## 1   2011    11         22         2     635     825       American
## 2   2011     8         25         4     602     758 American_Eagle
## 3   2011    10         12         3     559     738 American_Eagle
## 4   2011     5          2         1     716     854       American
## 5   2011     4          4         1     741     949       American
## 6   2011     4          4         1     627     742 American_Eagle
## 7   2011     6         21         2     726     848     ExpressJet
## 8   2011     9          1         4     715     844       American
## 9   2011     3         14         1     729     917    Continental
## 10  2011    12          5         1     724     847    Continental
## # ... with 789 more rows, and 14 more variables: FlightNum &lt;int&gt;,
## #   TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;, AirTime &lt;int&gt;, ArrDelay &lt;int&gt;,
## #   DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;int&gt;,
## #   TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;, CancellationCode &lt;chr&gt;,
## #   Diverted &lt;int&gt;
</pre></div>
</td></tr></table>

<h4 id="4-summarise-and-the-pipe-operator">4, <code class="codehilite">summarise</code> and the Pipe Operator<a class="headerlink" href="#4-summarise-and-the-pipe-operator" title="Permanent link">&para;</a></h4>
<p><strong>The syntax of summarise</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print out a summary with variables min_dist and max_dist</span>
summarise<span class="p">(</span>hflights<span class="p">,</span> min_dist <span class="o">=</span> <span class="kp">min</span><span class="p">(</span>Distance<span class="p">),</span> max_dist <span class="o">=</span> <span class="kp">max</span><span class="p">(</span>Distance<span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 2
##   min_dist max_dist
##      &lt;int&gt;    &lt;int&gt;
## 1       79     3904
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Print out a summary with variable max_div</span>
summarise<span class="p">(</span>filter<span class="p">(</span>hflights<span class="p">,</span> Diverted <span class="o">==</span> <span class="m">1</span><span class="p">),</span> max_div <span class="o">=</span> <span class="kp">max</span><span class="p">(</span>Distance<span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 1
##   max_div
##     &lt;int&gt;
## 1    3904
</pre></div>
</td></tr></table>

<p><strong>Aggregate functions</strong></p>
<p><code class="codehilite">summarise</code>:</p>
<ul>
<li><code class="codehilite">min(x)</code>; minimum value of vector x.</li>
<li><code class="codehilite">max(x)</code>; maximum value of vector x.</li>
<li><code class="codehilite">mean(x)</code>; mean value of vector x.</li>
<li><code class="codehilite">median(x)</code>; median value of vector x.</li>
<li><code class="codehilite">quantile(x, p)</code>; pth quantile of vector x.</li>
<li><code class="codehilite">sd(x)</code>; standard deviation of vector x.</li>
<li><code class="codehilite">var(x)</code>; variance of vector x.</li>
<li><code class="codehilite">IQR(x)</code>; Inter Quartile Range (IQR) of vector x.</li>
<li><code class="codehilite">diff(range(x))</code>; total range of vector x.</li>
</ul>
<!-- -->

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Remove rows that have NA ArrDelay: temp1</span>
temp1 <span class="o">&lt;-</span> filter<span class="p">(</span>hflights<span class="p">,</span> <span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>ArrDelay<span class="p">))</span>

<span class="c1"># Generate summary about ArrDelay column of temp1</span>
summarise<span class="p">(</span>temp1<span class="p">,</span> earliest <span class="o">=</span> <span class="kp">min</span><span class="p">(</span>ArrDelay<span class="p">),</span> average <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>ArrDelay<span class="p">),</span> latest <span class="o">=</span> <span class="kp">max</span><span class="p">(</span>ArrDelay<span class="p">),</span> sd <span class="o">=</span> sd<span class="p">(</span>ArrDelay<span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 4
##   earliest  average latest       sd
##      &lt;int&gt;    &lt;dbl&gt;  &lt;int&gt;    &lt;dbl&gt;
## 1      -70 7.094334    978 30.70852
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Keep rows that have no NA TaxiIn and no NA TaxiOut: temp2</span>
temp2 <span class="o">&lt;-</span> filter<span class="p">(</span>hflights<span class="p">,</span> <span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>TaxiIn<span class="p">),</span> <span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>TaxiOut<span class="p">))</span>

<span class="c1"># Print the maximum taxiing difference of temp2 with summarise()</span>
summarise<span class="p">(</span>temp2<span class="p">,</span> max_taxi_diff <span class="o">=</span> <span class="kp">max</span><span class="p">(</span><span class="kp">abs</span><span class="p">(</span>TaxiIn <span class="o">-</span> TaxiOut<span class="p">)))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 1
##   max_taxi_diff
##           &lt;int&gt;
## 1           160
</pre></div>
</td></tr></table>

<p><strong><code class="codehilite">dplyr</code> aggregate functions</strong></p>
<ul>
<li><code class="codehilite">first(x)</code>; the first element of vector <code class="codehilite">x</code>.</li>
<li><code class="codehilite">last(x)</code>; the last element of vector <code class="codehilite">x</code>.</li>
<li><code class="codehilite">nth(x, n)</code>; The <code class="codehilite">n</code>th element of vector <code class="codehilite">x</code>.</li>
<li><code class="codehilite">n()</code>; The number of rows in the data.frame or group of observations<br />
    that <code class="codehilite">summarise()</code> describes.</li>
<li><code class="codehilite">n_distinct(x)</code>; The number of unique values in vector <code class="codehilite">x</code>.</li>
</ul>
<!-- -->

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Generate summarizing statistics for hflights</span>
summarise<span class="p">(</span>hflights<span class="p">,</span> n_obs <span class="o">=</span> n<span class="p">(),</span> n_carrier <span class="o">=</span> n_distinct<span class="p">(</span>UniqueCarrier<span class="p">),</span> n_dest <span class="o">=</span> n_distinct<span class="p">(</span>Dest<span class="p">),</span> dest100 <span class="o">=</span> nth<span class="p">(</span>Dest<span class="p">,</span> <span class="m">100</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 4
##    n_obs n_carrier n_dest dest100
##    &lt;int&gt;     &lt;int&gt;  &lt;int&gt;   &lt;chr&gt;
## 1 227496        15    116     DFW
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Filter hflights to keep all American Airline flights: aa</span>
aa <span class="o">&lt;-</span> filter<span class="p">(</span>hflights<span class="p">,</span> UniqueCarrier <span class="o">==</span> <span class="s">&#39;American&#39;</span><span class="p">)</span>

<span class="c1"># Generate summarizing statistics for aa </span>
summarise<span class="p">(</span>aa<span class="p">,</span> n_flights <span class="o">=</span> n<span class="p">(),</span> n_canc <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span>Cancelled<span class="p">),</span> p_canc <span class="o">=</span> n_canc<span class="o">/</span>n_flights<span class="o">*</span><span class="m">100</span><span class="p">,</span> avg_delay <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>ArrDelay<span class="p">,</span> na.rm <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 4
##   n_flights n_canc   p_canc avg_delay
##       &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1      3244     60 1.849568 0.8917558
</pre></div>
</td></tr></table>

<p><strong>Overview of syntax</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Write the &#39;piped&#39; version of the English sentences</span>
hflights <span class="o">%&gt;%</span>
    mutate<span class="p">(</span>diff <span class="o">=</span> TaxiOut <span class="o">-</span> TaxiIn<span class="p">)</span> <span class="o">%&gt;%</span>
    filter<span class="p">(</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span><span class="kp">diff</span><span class="p">))</span> <span class="o">%&gt;%</span>
    summarise<span class="p">(</span> avg <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span><span class="kp">diff</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 1
##        avg
##      &lt;dbl&gt;
## 1 8.992064
</pre></div>
</td></tr></table>

<p><strong>Drive or fly? Part 1 of 2</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Part 1, concerning the selection and creation of columns</span>
d <span class="o">&lt;-</span> hflights <span class="o">%&gt;%</span>
  select<span class="p">(</span>Dest<span class="p">,</span> UniqueCarrier<span class="p">,</span> Distance<span class="p">,</span> ActualElapsedTime<span class="p">)</span> <span class="o">%&gt;%</span>  
  mutate<span class="p">(</span>RealTime <span class="o">=</span> ActualElapsedTime <span class="o">+</span> <span class="m">100</span><span class="p">,</span> mph <span class="o">=</span> Distance <span class="o">/</span> RealTime <span class="o">*</span> <span class="m">60</span><span class="p">)</span>

<span class="c1"># Part 2, concerning flights that had an actual average speed of &lt; 70 mph.</span>
d <span class="o">%&gt;%</span>
  filter<span class="p">(</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>mph<span class="p">),</span> mph <span class="o">&lt;</span> <span class="m">70</span><span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span> n_less <span class="o">=</span> n<span class="p">(),</span> 
             n_dest <span class="o">=</span> n_distinct<span class="p">(</span>Dest<span class="p">),</span> 
             min_dist <span class="o">=</span> <span class="kp">min</span><span class="p">(</span>Distance<span class="p">),</span> 
             max_dist <span class="o">=</span> <span class="kp">max</span><span class="p">(</span>Distance<span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 4
##   n_less n_dest min_dist max_dist
##    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
## 1   6726     13       79      305
</pre></div>
</td></tr></table>

<p><strong>Drive or fly? Part 2 of 2</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Solve the exercise using a combination of dplyr verbs and %&gt;%</span>
hflights <span class="o">%&gt;%</span>
    <span class="c1">#summarise(all_flights = n()) %&gt;%</span>
    filter<span class="p">(((</span>Distance <span class="o">/</span> <span class="p">(</span>ActualElapsedTime <span class="o">+</span> <span class="m">100</span><span class="p">)</span> <span class="o">*</span> <span class="m">60</span><span class="p">)</span> <span class="o">&lt;</span> <span class="m">105</span><span class="p">)</span> <span class="o">|</span> Cancelled <span class="o">==</span> <span class="m">1</span> <span class="o">|</span> Diverted <span class="o">==</span> <span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
    summarise<span class="p">(</span>n_non <span class="o">=</span> n<span class="p">(),</span> p_non <span class="o">=</span> n_non <span class="o">/</span> <span class="m">22751</span> <span class="o">*</span><span class="m">100</span><span class="p">,</span> n_dest <span class="o">=</span> n_distinct<span class="p">(</span>Dest<span class="p">),</span> min_dist <span class="o">=</span> <span class="kp">min</span><span class="p">(</span>Distance<span class="p">),</span> max_dist <span class="o">=</span> <span class="kp">max</span><span class="p">(</span>Distance<span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 5
##   n_non    p_non n_dest min_dist max_dist
##   &lt;int&gt;    &lt;dbl&gt;  &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
## 1 42400 186.3654    113       79     3904
</pre></div>
</td></tr></table>

<p><strong>Advanced piping exercise</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Count the number of overnight flights</span>
hflights <span class="o">%&gt;%</span>
    filter<span class="p">(</span>ArrTime <span class="o">&lt;</span> DepTime <span class="o">&amp;</span> <span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>DepTime<span class="p">)</span> <span class="o">&amp;</span> <span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>ArrTime<span class="p">))</span> <span class="o">%&gt;%</span>
    summarise<span class="p">(</span>n <span class="o">=</span> n<span class="p">())</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 1 × 1
##       n
##   &lt;int&gt;
## 1  2718
</pre></div>
</td></tr></table>

<h4 id="5-group_by-and-working-with-data">5, <code class="codehilite">group_by</code> and working with data<a class="headerlink" href="#5-group_by-and-working-with-data" title="Permanent link">&para;</a></h4>
<p><strong>Unite and conquer using <code class="codehilite">group_by</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Make an ordered per-carrier summary of hflights</span>
hflights <span class="o">%&gt;%</span>
   group_by<span class="p">(</span>UniqueCarrier<span class="p">)</span> <span class="o">%&gt;%</span>
   summarise<span class="p">(</span>n_flights <span class="o">=</span> n<span class="p">(),</span> 
             n_canc <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span>Cancelled <span class="o">==</span> <span class="m">1</span><span class="p">),</span> 
             p_canc <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>Cancelled <span class="o">==</span> <span class="m">1</span><span class="p">)</span> <span class="o">*</span> <span class="m">100</span><span class="p">,</span> 
             avg_delay <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>ArrDelay<span class="p">,</span> na.rm <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="o">%&gt;%</span>
   arrange<span class="p">(</span>avg_delay<span class="p">,</span> p_canc<span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 15 × 5
##         UniqueCarrier n_flights n_canc    p_canc  avg_delay
##                 &lt;chr&gt;     &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1          US_Airways      4082     46 1.1268986 -0.6307692
## 2            American      3244     60 1.8495684  0.8917558
## 3             AirTran      2139     21 0.9817672  1.8536239
## 4              Alaska       365      0 0.0000000  3.1923077
## 5                Mesa        79      1 1.2658228  4.0128205
## 6               Delta      2641     42 1.5903067  6.0841374
## 7         Continental     70032    475 0.6782614  6.0986983
## 8      American_Eagle      4648    135 2.9044750  7.1529751
## 9  Atlantic_Southeast      2204     76 3.4482759  7.2569543
## 10          Southwest     45343    703 1.5504047  7.5871430
## 11           Frontier       838      6 0.7159905  7.6682692
## 12         ExpressJet     73053   1132 1.5495599  8.1865242
## 13            SkyWest     16061    224 1.3946828  8.6934922
## 14            JetBlue       695     18 2.5899281  9.8588410
## 15             United      2072     34 1.6409266 10.4628628
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Make an ordered per-day summary of hflights</span>
hflights <span class="o">%&gt;%</span> 
   group_by<span class="p">(</span>DayOfWeek<span class="p">)</span> <span class="o">%&gt;%</span>
   summarise<span class="p">(</span>avg_taxi <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>TaxiIn <span class="o">+</span> TaxiOut<span class="p">,</span> na.rm<span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span> <span class="o">%&gt;%</span>
   arrange<span class="p">(</span>desc<span class="p">(</span>avg_taxi<span class="p">))</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 7 × 2
##   DayOfWeek avg_taxi
##       &lt;int&gt;    &lt;dbl&gt;
## 1         1 21.77027
## 2         2 21.43505
## 3         4 21.26076
## 4         3 21.19055
## 5         5 21.15805
## 6         7 20.93726
## 7         6 20.43061
</pre></div>
</td></tr></table>

<p><strong>Combine <code class="codehilite">group_by</code> with <code class="codehilite">mutate</code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Solution to first instruction</span>
hflights <span class="o">%&gt;%</span>
    filter<span class="p">(</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>ArrDelay<span class="p">))</span> <span class="o">%&gt;%</span>
    group_by<span class="p">(</span>UniqueCarrier<span class="p">)</span> <span class="o">%&gt;%</span>
    summarise<span class="p">(</span>p_delay <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span>ArrDelay <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="o">/</span> n<span class="p">())</span> <span class="o">%&gt;%</span>
    mutate<span class="p">(</span>rank <span class="o">=</span> <span class="kp">rank</span><span class="p">(</span>p_delay<span class="p">))</span> <span class="o">%&gt;%</span>
    arrange<span class="p">(</span><span class="kp">rank</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 15 × 3
##         UniqueCarrier   p_delay  rank
##                 &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
## 1            American 0.3030208     1
## 2             AirTran 0.3112269     2
## 3          US_Airways 0.3267990     3
## 4  Atlantic_Southeast 0.3677511     4
## 5      American_Eagle 0.3696714     5
## 6               Delta 0.3871092     6
## 7             JetBlue 0.3952452     7
## 8              Alaska 0.4368132     8
## 9           Southwest 0.4644557     9
## 10               Mesa 0.4743590    10
## 11        Continental 0.4907385    11
## 12         ExpressJet 0.4943420    12
## 13             United 0.4963109    13
## 14            SkyWest 0.5350105    14
## 15           Frontier 0.5564904    15
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Solution to second instruction</span>
hflights <span class="o">%&gt;%</span>
    filter<span class="p">(</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>ArrDelay<span class="p">),</span> ArrDelay <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span>
    group_by<span class="p">(</span>UniqueCarrier<span class="p">)</span> <span class="o">%&gt;%</span>
    summarise<span class="p">(</span>avg <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>ArrDelay<span class="p">))</span> <span class="o">%&gt;%</span>
    mutate<span class="p">(</span>rank <span class="o">=</span> <span class="kp">rank</span><span class="p">(</span>avg<span class="p">))</span> <span class="o">%&gt;%</span>
    arrange<span class="p">(</span><span class="kp">rank</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## # A tibble: 15 × 3
##         UniqueCarrier      avg  rank
##                 &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1                Mesa 18.67568     1
## 2            Frontier 18.68683     2
## 3          US_Airways 20.70235     3
## 4         Continental 22.13374     4
## 5              Alaska 22.91195     5
## 6             SkyWest 24.14663     6
## 7          ExpressJet 24.19337     7
## 8           Southwest 25.27750     8
## 9             AirTran 27.85693     9
## 10           American 28.49740    10
## 11              Delta 32.12463    11
## 12             United 32.48067    12
## 13     American_Eagle 38.75135    13
## 14 Atlantic_Southeast 40.24231    14
## 15            JetBlue 45.47744    15
</pre></div>
</td></tr></table>

<p><strong>Advanced <code class="codehilite">group_by</code> exercises</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Which plane (by tail number) flew out of Houston the most times? How many times? adv1</span>
adv1 <span class="o">&lt;-</span> hflights <span class="o">%&gt;%</span>
          group_by<span class="p">(</span>TailNum<span class="p">)</span> <span class="o">%&gt;%</span>
          summarise<span class="p">(</span>n <span class="o">=</span> n<span class="p">())</span> <span class="o">%&gt;%</span>
          filter<span class="p">(</span>n <span class="o">==</span> <span class="kp">max</span><span class="p">(</span>n<span class="p">))</span>

<span class="c1"># How many airplanes only flew to one destination from Houston? adv2</span>
adv2 <span class="o">&lt;-</span> hflights <span class="o">%&gt;%</span>
          group_by<span class="p">(</span>TailNum<span class="p">)</span> <span class="o">%&gt;%</span>
          summarise<span class="p">(</span>ndest <span class="o">=</span> n_distinct<span class="p">(</span>Dest<span class="p">))</span> <span class="o">%&gt;%</span>
          filter<span class="p">(</span>ndest <span class="o">==</span> <span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
          summarise<span class="p">(</span>nplanes <span class="o">=</span> n<span class="p">())</span>

<span class="c1"># Find the most visited destination for each carrier: adv3</span>
adv3 <span class="o">&lt;-</span> hflights <span class="o">%&gt;%</span> 
          group_by<span class="p">(</span>UniqueCarrier<span class="p">,</span> Dest<span class="p">)</span> <span class="o">%&gt;%</span>
          summarise<span class="p">(</span>n <span class="o">=</span> n<span class="p">())</span> <span class="o">%&gt;%</span>
          mutate<span class="p">(</span>rank <span class="o">=</span> <span class="kp">rank</span><span class="p">(</span>desc<span class="p">(</span>n<span class="p">)))</span> <span class="o">%&gt;%</span>
          filter<span class="p">(</span>rank <span class="o">==</span> <span class="m">1</span><span class="p">)</span>

<span class="c1"># Find the carrier that travels to each destination the most: adv4</span>
adv4 <span class="o">&lt;-</span> hflights <span class="o">%&gt;%</span> 
          group_by<span class="p">(</span>Dest<span class="p">,</span> UniqueCarrier<span class="p">)</span> <span class="o">%&gt;%</span>
          summarise<span class="p">(</span>n <span class="o">=</span> n<span class="p">())</span> <span class="o">%&gt;%</span>
          mutate<span class="p">(</span>rank <span class="o">=</span> <span class="kp">rank</span><span class="p">(</span>desc<span class="p">(</span>n<span class="p">)))</span> <span class="o">%&gt;%</span>
          filter<span class="p">(</span>rank <span class="o">==</span> <span class="m">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p><strong><code class="codehilite">dplyr</code> deals with different types</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Use summarise to calculate n_carrier</span>
s2 <span class="o">&lt;-</span> hflights <span class="o">%&gt;%</span>
    summarise<span class="p">(</span>n_carrier <span class="o">=</span> n_distinct<span class="p">(</span>UniqueCarrier<span class="p">))</span>
</pre></div>
</td></tr></table>

<p><strong><code class="codehilite">dplyr</code> and mySQL databases</strong></p>
<p>Code only.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># set up a src that connects to the mysql database (src_mysql is provided by dplyr)</span>
my_db <span class="o">&lt;-</span> src_mysql<span class="p">(</span>dbname <span class="o">=</span> <span class="s">&#39;dplyr&#39;</span><span class="p">,</span> 
                  host <span class="o">=</span> <span class="s">&#39;dplyr.csrrinzqubik.us-east-1.rds.amazonaws.com&#39;</span><span class="p">,</span> 
                  port <span class="o">=</span> <span class="m">3306</span><span class="p">,</span>
                  user <span class="o">=</span> <span class="s">&#39;dplyr&#39;</span><span class="p">,</span>
                  password <span class="o">=</span> <span class="s">&#39;dplyr&#39;</span><span class="p">)</span>

<span class="c1"># and reference a table within that src: nycflights is now available as an R object that references to the remote nycflights table</span>
nycflights <span class="o">&lt;-</span> tbl<span class="p">(</span>my_db<span class="p">,</span> <span class="s">&#39;dplyr&#39;</span><span class="p">)</span>

<span class="c1"># glimpse at nycflights</span>
glimpse<span class="p">(</span>nycflights<span class="p">)</span>

<span class="c1"># Calculate the grouped summaries detailed in the instructions</span>
nycflights <span class="o">%&gt;%</span>
   group_by<span class="p">(</span>carrier<span class="p">)</span> <span class="o">%&gt;%</span>
   summarise<span class="p">(</span>n_flights <span class="o">=</span> n<span class="p">(),</span> avg_delay <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>arr_delay<span class="p">))</span> <span class="o">%&gt;%</span>
   arrange<span class="p">(</span>avg_delay<span class="p">)</span>
</pre></div>
</td></tr></table>

<h3 id="adding-tidyr-functions">Adding <code class="codehilite">tidyr</code> Functions<a class="headerlink" href="#adding-tidyr-functions" title="Permanent link">&para;</a></h3>
<ul>
<li><code class="codehilite">complete</code></li>
<li><code class="codehilite">drop_na</code></li>
<li><code class="codehilite">expand</code></li>
<li><code class="codehilite">extract</code></li>
<li><code class="codehilite">extract_numeric</code></li>
<li><code class="codehilite">complete</code></li>
<li><code class="codehilite">fill</code></li>
<li><code class="codehilite">full_seq</code></li>
<li><code class="codehilite">gather</code></li>
<li><code class="codehilite">nest</code></li>
<li><code class="codehilite">replace_na</code></li>
<li><code class="codehilite">separate</code></li>
<li><code class="codehilite">separate_rows</code></li>
<li><code class="codehilite">separate_rows_</code></li>
<li><code class="codehilite">smiths</code></li>
<li><code class="codehilite">spread</code></li>
<li><code class="codehilite">table1</code></li>
<li><code class="codehilite">unite</code></li>
<li><code class="codehilite">unnest</code></li>
<li><code class="codehilite">who</code></li>
</ul>
<hr />
<h3 id="extension-joining-data-in-r-with-dplyr">Extension: &lsquo;Joining Data in R with <code class="codehilite">dplyr</code>&lsquo;<a class="headerlink" href="#extension-joining-data-in-r-with-dplyr" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## 1, Mutating Joins

## 2, Filtering Joins and Set Operations

## 3, Assembling Data

## 4, Advanced Joining

## 5, Case Study
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Data_Manipulation_in_R_with_dplyr/" title="Data Manipulation in R with dplyr" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Data Manipulation in R with dplyr
              </span>
            </div>
          </a>
        
        
          <a href="../Plot_snippets_-_Basics/" title="Plot Snippets for Exploratory (and some Explanatory) Analyses" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Plot Snippets for Exploratory (and some Explanatory) Analyses
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            © Ugo Sparks
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-93008985-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>